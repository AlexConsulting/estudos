<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7 Dias: A Sufici√™ncia de Cristo (Devocional)</title>
    <style>
        /* 1. CSS PRINCIPAL (LIGHT THEME - PADR√ÉO) */
        body {
            font-family: 'Georgia', serif;
            margin: 0;
            background-color: #e6e0d3; /* Papel envelhecido */
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px 0; /* Adicionado padding para garantir espa√ßo em telas pequenas */
            transition: background-color 0.3s, color 0.3s;
        }
        .book-container {
            max-width: 650px;
            width: 90%;
            background: #fdfdfd;
            padding: 30px 40px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid #ccc;
            position: relative;
            transition: background 0.3s, box-shadow 0.3s;
        }
        h1 {
            color: #4b0082;
            text-align: center;
            font-family: 'Times New Roman', serif;
            border-bottom: 2px solid #4b0082;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            font-style: italic;
            margin-bottom: 20px;
            color: #555;
            font-size: 0.95em;
        }
        h2 {
            color: #007bff;
            font-size: 1.5em;
            text-align: center;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .versiculos {
            font-style: italic;
            background-color: #f0f8ff;
            padding: 15px;
            border-left: 5px solid #28a745;
            margin: 15px 0;
            font-weight: 500;
        }
        .section {
            margin-top: 20px;
            padding: 10px;
            border-bottom: 1px dashed #ddd;
        }
        .section strong {
            display: block;
            color: #dc3545;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .oracao-final {
            margin-top: 25px;
            padding: 15px;
            background-color: #fffae0;
            border-left: 5px solid #ffc107;
            font-weight: bold;
            text-align: center;
            font-style: italic;
        }
        
        /* 2. NAVEGA√á√ÉO E UTILS */
        .top-utils {
            display: flex;
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap; 
            gap: 15px; 
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            flex-wrap: wrap; 
            gap: 15px; 
        }
        
        /* ESTILO PADR√ÉO DOS BOT√ïES DE NAVEGA√á√ÉO (Anterior/Pr√≥ximo) */
        .nav-button {
            padding: 10px 15px;
            cursor: pointer;
            border: 1px solid #007bff;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: opacity 0.2s, background 0.2s, border-color 0.2s;
        }
        .nav-button:disabled {
            opacity: 0.5;
            cursor: default;
        }

        /* 3. DARK THEME CSS */
        .dark-theme {
            background-color: #121212;
            color: #f4f4f4;
        }
        .dark-theme .book-container {
            background: #1e1e1e;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border-color: #333;
        }
        .dark-theme h1 {
            color: #bb86fc;
            border-bottom-color: #bb86fc;
        }
        .dark-theme .subtitle {
            color: #aaa;
        }
        .dark-theme h2 {
            color: #03dac6;
        }
        .dark-theme .versiculos {
            background-color: #2c2c2c;
            border-left-color: #03dac6;
        }
        .dark-theme .section {
            border-bottom-color: #444;
        }
        .dark-theme .section strong {
            color: #cf6679;
        }
        .dark-theme .oracao-final {
            background-color: #33331c;
            border-left-color: #ffd600;
        }
        
        /* Tema: Botoes de Navega√ß√£o escuros (Anterior/Pr√≥ximo) */
        .dark-theme .nav-button {
            background-color: #03dac6;
            border-color: #03dac6;
            color: #1e1e1e;
        }
        
        /* 4. SELETOR DE IDIOMA, LEITURA E TEMA (FUNDO NEUTRO UNIFICADO) */
        .language-selector-wrapper {
            position: relative;
            display: inline-block;
            z-index: 10;
        }

        /* Aplicando o estilo de fundo neutro para o seletor de idiomas, bot√£o de tema E bot√£o de escuta */
        #langSelectButton, #themeToggle, #listenToggle { 
            /* ESTILO NEUTRO UNIFICADO: Cinza Claro */
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            color: #333;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 0.9em;
            font-weight: bold; 
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        
        #listenToggle[disabled] {
            opacity: 0.6;
            cursor: wait;
        }

        #langSelectButton:hover, #themeToggle:hover, #listenToggle:hover:not([disabled]) {
            background-color: #e0e0e0;
        }

        .lang-flag-active {
            width: 24px;
            height: 18px;
            margin-right: 8px;
            border: 1px solid #ddd;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #langDropdown {
            display: none; 
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 150px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        #langDropdown a {
            color: #333;
            padding: 10px 15px;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 0.9em;
        }

        #langDropdown a:hover {
            background-color: #f5f5f5;
        }

        .lang-flag-dropdown {
            width: 20px;
            height: 15px;
            margin-right: 10px;
            border: 1px solid #eee;
        }

        /* Ajustes de Tema Escuro para Bot√µes de Utilidade (UNIFICADOS) */
        .dark-theme #langSelectButton, .dark-theme #themeToggle, .dark-theme #listenToggle {
            background-color: #2c2c2c;
            border-color: #444;
            color: #f4f4f4;
        }
        
        .dark-theme #langSelectButton:hover, .dark-theme #themeToggle:hover, .dark-theme #listenToggle:hover:not([disabled]) {
            background-color: #333;
        }


        .dark-theme #langDropdown {
            background-color: #1e1e1e;
            border-color: #444;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .dark-theme #langDropdown a {
            color: #f4f4f4;
        }

        .dark-theme #langDropdown a:hover {
            background-color: #333;
        }
        
        /* 5. MEDIA QUERIES (Ajustes para Celular) */
        @media (max-width: 600px) {
            .book-container {
                padding: 20px 25px; 
                width: 95%; 
            }
            .top-utils {
                flex-direction: column; 
                align-items: flex-start; 
                gap: 10px; 
            }

            .navigation {
                flex-direction: column; 
                gap: 10px; 
            }
            .nav-button {
                width: 100%; 
            }
             
            .progress-check { 
                order: -1; 
                width: 100%; 
            }
        }
        
        /* 6. ESTILOS DA BARRA DE PROGRESSO E CHECKBOX (mantidos) */
        .progress-bar-wrapper {
            background-color: #ddd;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .progress-bar {
            height: 100%;
            width: 0%; 
            background-color: #28a745;
            border-radius: 10px;
            transition: width 0.5s ease-in-out;
        }
        
        .dark-theme #progressLabel {
            color: #03dac6;
        }

        .dark-theme .progress-bar-wrapper {
            background-color: #333;
        }

        .dark-theme .progress-bar {
            background-color: #03dac6;
        }
        
        .progress-check {
             display: flex;
             align-items: center;
             justify-content: center;
             margin: 0;
             flex-grow: 0;
             flex-shrink: 0;
             padding: 5px 10px;
             background-color: #e6f7ff; 
             border: 1px solid #b3e0ff;
             border-radius: 5px;
             transition: background-color 0.3s;
             order: 0;
        }
        .progress-check label {
            margin-left: 10px;
            font-weight: bold;
            color: #1e8449;
            cursor: pointer;
        }
        .progress-check input[type="checkbox"] {
            transform: scale(1.3);
            cursor: pointer;
        }
        
        .dark-theme .progress-check {
            background-color: #2c2c2c;
            border-color: #444;
        }
        .dark-theme .progress-check label {
            color: #03dac6;
        }

        /* NOVO: Estilos Espec√≠ficos da Barra de Progresso do √Åudio */
        #audioProgressContainer {
            height: 5px;
            width: 100%;
            background-color: #ddd; 
            border-radius: 2px;
            overflow: hidden;
            margin-top: 5px; 
            margin-bottom: 10px; /* Adicionado para espa√ßamento */
        }
        #audioProgressBar {
            height: 100%;
            width: 0%;
            background-color: #ffc107; /* Amarelo para destacar o √°udio */
            transition: width 0.1s linear; 
        }

        .dark-theme #audioProgressContainer {
            background-color: #333;
        }
        .dark-theme #audioProgressBar {
            background-color: #ffd600; 
        }
    </style>
</head>
<body class="light-theme">

    <div class="book-container">
        <div class="top-utils">
            <div class="language-selector-wrapper">
                <button id="langSelectButton" aria-haspopup="true" aria-expanded="false" title="Selecionar Idioma">
                    </button>
                <div id="langDropdown">
                    </div>
            </div>
            
            <button id="listenToggle" class="nav-button" title="Ouvir Conte√∫do" disabled>
                </button>
            
            <button id="themeToggle" class="nav-button" title="Mudar Tema">
                </button>
        </div>
        
        <div id="audioProgressContainer" style="display: none;">
            <div id="audioProgressBar" class="progress-bar"></div>
        </div>

        <h1 id="mainTitle">7 Dias: A Sufici√™ncia de Cristo (Livro de G√°latas) </h1>
		<p class="subtitle" id="subTitle">Uma caminhada de gra√ßa, identidade e liberdade.</p>
        
        <div id="progressContainer" style="margin-bottom: 15px;">
            <p id="progressLabel" style="text-align: center; font-size: 0.9em; margin-bottom: 5px; color: #4b0082; font-weight: bold;"></p>
            <div class="progress-bar-wrapper">
                <div id="progressBar" class="progress-bar"></div>
            </div>
        </div>
        <p id="pageCounter" style="text-align: right;"></p>
        
        <div id="devotionalContent">
            </div>

        <div class="navigation">
            <button id="prevButton" class="nav-button" disabled>‚Üê Anterior</button>
            
            <div class="progress-check">
                <input type="checkbox" id="completedCheck">
                <label for="completedCheck" id="checkLabel">Marcar como Conclu√≠do</label>
            </div>
            
            <button id="nextButton" class="nav-button">Pr√≥ximo ‚Üí</button>
        </div>
    </div>

    <footer>
        <p>Devocional adaptado e criado por Alex Silva | <span id="footerText"></span></p>
    </footer>

    <script>
        // --- DADOS MULTI-IDIOMA E TEMA ---
        const flagMap = {
            'pt-BR': { icon: '<img src="https://flagicons.lipis.dev/flags/4x3/br.svg" class="lang-flag-dropdown" alt="Portugu√™s">', text: 'Portugu√™s', iconActive: '<img src="https://flagicons.lipis.dev/flags/4x3/br.svg" class="lang-flag-active" alt="Portugu√™s">' },
            'en-US': { icon: '<img src="https://flagicons.lipis.dev/flags/4x3/us.svg" class="lang-flag-dropdown" alt="English">', text: 'English', iconActive: '<img src="https://flagicons.lipis.dev/flags/4x3/us.svg" class="lang-flag-active" alt="English">' },
            'es-ES': { icon: '<img src="https://flagicons.lipis.dev/flags/4x3/es.svg" class="lang-flag-dropdown" alt="Espa√±ol">', text: 'Espa√±ol', iconActive: '<img src="https://flagicons.lipis.dev/flags/4x3/es.svg" class="lang-flag-active" alt="Espa√±ol">' },
            'fr-FR': { icon: '<img src="https://flagicons.lipis.dev/flags/4x3/fr.svg" class="lang-flag-dropdown" alt="Fran√ßais">', text: 'Fran√ßais', iconActive: '<img src="https://flagicons.lipis.dev/flags/4x3/fr.svg" class="lang-flag-active" alt="Fran√ßais">' }
        };
        
        const themeMap = {
            'light': { icon: '‚òÄÔ∏è', next: 'dark' },
            'dark': { icon: 'üåô', next: 'light' }
        };

        const SAVED_THEME = localStorage.getItem('theme') || 'light'; 
        const SAVED_LANG = localStorage.getItem('language') || 'pt-BR'; 

        let currentTheme = SAVED_THEME;
        
        // --- VARI√ÅVEIS DE ESTADO ---
        const totalDays = 7;
        let currentDay = 1;
        let currentLang = SAVED_LANG; 
        
        // NOVO TTS: Objetos da Web Speech API e vari√°veis de controle
        const synth = window.speechSynthesis; 
        let utterance = null; 
        let totalChars = 0; // Para calcular o progresso
        let ttsVoices = []; // Cache das vozes dispon√≠veis (CORRE√á√ÉO 1)
        let ttsInitialized = false; // Novo: Vari√°vel de controle para inicializa√ß√£o do TTS
        
        // CHAVE √öNICA DO DEVOCIONAL.
        const DEVOTIONAL_KEY = 'galatas'; 
        
        // --- DADOS MULTI-IDIOMA (Tradu√ß√µes) ---
        const translations = {
            'pt-BR': {
                mainTitle: "7 Dias: A Sufici√™ncia de Cristo (Livro de G√°latas)",
				subTitle: "Uma caminhada de gra√ßa, identidade e liberdade",
                dayTitle: "Dia",
                progressLabelPrefix: "Progresso: ",
                checkLabel: "Marcar como Conclu√≠do",
                navPrev: "‚Üê Anterior",
                navNext: "Pr√≥ximo ‚Üí",
                footerText: "Direitos Reservados 2024",
                themeLight: "üåô Modo Escuro", 
                themeDark: "‚òÄÔ∏è Modo Claro",
                listenStart: "üîä Ou√ßa Aqui", 
                listenStop: "üõë Parar Leitura",
                listenPause: "‚è∏Ô∏è Pausar √Åudio",
                listenResume: "‚ñ∂Ô∏è Continuar",
                noContentAlert: "Conte√∫do para leitura n√£o encontrado.",
                ttsLoading: "‚è≥ Carregando √Åudio...", // NOVO
                ttsUnsupported: "‚ùå √Åudio Indispon√≠vel", // NOVO
                versiculoChave: "Vers√≠culo Chave:", 
                resumoMeditacao: "Resumo/Medita√ß√£o:", 
                aplicacaoPratica: "Aplica√ß√£o Pr√°tica:", 
                oracaoLabel: "Ora√ß√£o:",
            },
            'en-US': {
                mainTitle: "7 Days: The Sufficiency of Christ (Book of Galatians)",
				subTitle: "A journey of grace, identity, and freedom.",
                dayTitle: "Day",
                progressLabelPrefix: "Progress: ",
                checkLabel: "Mark as Completed",
                navPrev: "‚Üê Previous",
                navNext: "Next ‚Üí",
                footerText: "All Rights Reserved 2024",
                themeLight: "üåô Dark Mode",
                themeDark: "‚òÄÔ∏è Light Mode",
                listenStart: "üîä Listen Here", 
                listenStop: "üõë Stop Reading",
                listenPause: "‚è∏Ô∏è Pause Audio",
                listenResume: "‚ñ∂Ô∏è Resume",
                noContentAlert: "Content for reading not found.",
                ttsLoading: "‚è≥ Loading Audio...", 
                ttsUnsupported: "‚ùå Audio Unavailable",
                versiculoChave: "Key Verse:", 
                resumoMeditacao: "Summary/Meditation:", 
                aplicacaoPratica: "Practical Application:", 
                oracaoLabel: "Prayer:",
            },
            'es-ES': {
                mainTitle: "7 D√≠as: La Suficiencia de Cristo (Libro de G√°latas)",
				subTitle: "Una caminata de gracia, identidad y libertad.",	
                dayTitle: "D√≠a",
                progressLabelPrefix: "Progreso: ",
                checkLabel: "Marcar como Concluido",
                navPrev: "‚Üê Anterior",
                navNext: "Siguiente ‚Üí",
                footerText: "Todos los derechos reservados 2024",
                themeLight: "üåô Modo Oscuro",
                themeDark: "‚òÄÔ∏è Modo Claro",
                listenStart: "üîä Escuchar Aqu√≠", 
                listenStop: "üõë Detener Lectura",
                listenPause: "‚è∏Ô∏è Pausar Audio",
                listenResume: "‚ñ∂Ô∏è Continuar",
                noContentAlert: "Contenido para escuchar no encontrado.",
                ttsLoading: "‚è≥ Cargando Audio...", 
                ttsUnsupported: "‚ùå Audio No Disponible",
                versiculoChave: "Vers√≠culo Clave:", 
                resumoMeditacao: "Resumen/Meditaci√≥n:", 
                aplicacaoPratica: "Aplicaci√≥n Pr√°ctica:", 
                oracaoLabel: "Oraci√≥n:",
            },
            'fr-FR': {
                mainTitle: "7 Jours : La Suffisance du Christ (Livre des Galates)",
				subTitle: "Un parcours de gr√¢ce, d‚Äôidentit√© et de libert√©.",
                dayTitle: "Jour",
                progressLabelPrefix: "Progression : ",
                checkLabel: "Marquer comme Accomplie",
                navPrev: "‚Üê Pr√©c√©dent",
                navNext: "Suivant ‚Üí",
                footerText: "Tous droits r√©serv√©s 2024",
                themeLight: "üåô Mode Sombre",
                themeDark: "‚òÄÔ∏è Mode Clair",
                listenStart: "üîä √âcoutez Ici", 
                listenStop: "üõë Arr√™ter Lecture",
                listenPause: "‚è∏Ô∏è Pause Audio", 
                listenResume: "‚ñ∂Ô∏è Reprendre",
                noContentAlert: "Contenu √† lire introuvable.",
                ttsLoading: "‚è≥ Chargement Audio...", 
                ttsUnsupported: "‚ùå Audio Indisponible",
                versiculoChave: "Verset Cl√©:", 
                resumoMeditacao: "R√©sum√©/M√©ditation:", 
                aplicacaoPratique: "Application Pratique:", 
                oracaoLabel: "Pri√®re:",
            }
        };

        // --- ELEMENTOS DOM ---
        const mainTitle = document.getElementById('mainTitle');
        const subTitle = document.getElementById('subTitle');
        const progressLabel = document.getElementById('progressLabel');
        const checkLabel = document.getElementById('checkLabel');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const completedCheck = document.getElementById('completedCheck');
        const devotionalContentDiv = document.getElementById('devotionalContent');
        const footerText = document.getElementById('footerText');
        const progressBar = document.getElementById('progressBar');

        // ELEMENTOS DOM TTS/TEMA
        const langSelectButton = document.getElementById('langSelectButton');
        const langDropdown = document.getElementById('langDropdown');
        const themeToggle = document.getElementById('themeToggle');
        const listenToggle = document.getElementById('listenToggle'); 
        const audioProgressContainer = document.getElementById('audioProgressContainer');
        const audioProgressBar = document.getElementById('audioProgressBar');


  // * FUN√á√ïES DE UTILIDADE *
    
		function handleCompletedCheck() {
			saveCompletion(currentDay, completedCheck.checked);

		if (completedCheck.checked && currentDay < totalDays) {
			nextDay();
    }
}
        
        // --- FUN√á√ïES DE TEMA ---
        function applyTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('theme', theme);
            
            document.body.classList.remove('light-theme', 'dark-theme');
            document.body.classList.add(theme === 'dark' ? 'dark-theme' : 'light-theme');
        }

        function toggleDarkMode() {
            const newTheme = themeMap[currentTheme].next;
            applyTheme(newTheme);
            updateTexts(0);
        }

        function loadThemePreference() {
            applyTheme(SAVED_THEME);
        }
        
        // --- FUN√á√ïES DE IDIOMA (COM BANDEIRAS) ---
        function setLanguage(langCode) {
            currentLang = langCode;
            localStorage.setItem('language', langCode);
            
            // Parar a leitura ao trocar de idioma
            stopSpeaking(); 
            
            updateTexts(0);
            updateLanguageSelector();
            // ‚úÖ CORRE√á√ÉO: Apenas atualiza o estado visual para a nova l√≠ngua. 
            // A habilita√ß√£o/desabilita√ß√£o √© tratada na inicializa√ß√£o do TTS (initTTS).
            updateListenToggle('start'); 
        }

        function updateLanguageSelector() {
            if (!langSelectButton || !langDropdown) return;
            
            const currentFlag = flagMap[currentLang];
            // 1. Atualiza o bot√£o com a bandeira e nome do idioma ativo
            langSelectButton.innerHTML = currentFlag.iconActive + currentFlag.text;
            
            // 2. Limpa e reconstr√≥i o dropdown, excluindo o idioma ativo
            langDropdown.innerHTML = '';
            Object.keys(flagMap).forEach(lang => {
                if (lang !== currentLang) {
                    const flag = flagMap[lang];
                    const link = document.createElement('a');
                    link.innerHTML = flag.icon + flag.text; 
                    link.setAttribute('data-lang', lang);
                    link.setAttribute('href', '#'); 
                    
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        setLanguage(lang);
                        langDropdown.style.display = 'none';
                    });
                    
                    langDropdown.appendChild(link);
                }
            });
        }

        // FUN√á√ÉO TTS: Fun√ß√µes de controle da barra de progresso do √°udio
        function resetAudioProgressBar(hide = false) {
            if (audioProgressBar) audioProgressBar.style.width = '0%';
            if (audioProgressContainer) {
                // Apenas esconde se for pedido, para n√£o piscar no in√≠cio
                audioProgressContainer.style.display = hide ? 'none' : 'block';
            }
        }
        
        // --- FUN√á√ÉO DE ATUALIZA√á√ÉO DE TEXTOS (CORRIGIDA) ---
        function updateTexts(direction = 1) { 
            // 1. Obt√©m o objeto de tradu√ß√£o da interface (usa chave completa: pt-BR, fr-FR)
            const t = translations[currentLang] || translations['pt-BR']; 

            // 2. Aplica o idioma na tag <html> (usa raiz: pt, fr)
            document.documentElement.lang = currentLang.split('-')[0];

            // 3. Aplica as tradu√ß√µes nos elementos espec√≠ficos
            mainTitle.innerText = t.mainTitle;
            subTitle.innerText = t.subTitle;
            progressLabel.innerText = `${t.progressLabelPrefix}${t.dayTitle} ${currentDay} de ${totalDays}`;
            checkLabel.innerText = t.checkLabel;
            prevButton.innerText = t.navPrev;
            nextButton.innerText = t.navNext;
            footerText.innerText = t.footerText;
            
            // 4. Atualiza o texto do bot√£o de tema
            if (currentTheme === 'light') {
                themeToggle.innerHTML = t.themeLight; 
            } else {
                themeToggle.innerHTML = t.themeDark; 
            }

            // 5. Atualiza o conte√∫do DEVOCIONAL (AGORA SEM ANIMA√á√ÉO AS√çNCRONA)
            const contentLangKey = currentLang.substring(0, 2); 
            loadDevotionalContent(currentDay, contentLangKey, t);

            updateOverallProgress();

            // TTS: Garante que a leitura pare e o bot√£o seja atualizado ao trocar de p√°gina/idioma
            if (window.speechSynthesis && window.speechSynthesis.speaking) {
                stopSpeaking(); 
            }
        }
        
        // --- FUN√á√ÉO DE CARREGAMENTO DE CONTE√öDO (CORRIGIDA PARA SINCRONIA) ---
        function loadDevotionalContent(day, contentLangKey, t) { 
            // Busca o conte√∫do devocional (usa chave de 2 letras: pt, en, fr)
            const data = devotionalContent[day] ? devotionalContent[day][contentLangKey] || devotionalContent[day]['pt'] : null;
            
            if (!data) {
                devotionalContentDiv.innerHTML = `<p style="text-align: center;">${t.noContentAlert || 'Conte√∫do n√£o dispon√≠vel para o Dia ${day} neste idioma.'}</p>`;
                return;
            }
            
            // ‚úÖ RENDERIZA√á√ÉO IMEDIATA E SINCRONA
            devotionalContentDiv.innerHTML = `
                <h2 id="dayTitle">${t.dayTitle} ${day}: ${data.h2}</h2>
                <div class="section">
                    <strong>${t.versiculoChave}</strong>
                    <p class="versiculos">${data.versiculos}</p>
                </div>
                <div class="section">
                    <strong>${t.resumoMeditacao}</strong>
                    <p>${data.resumo}</p>
                </div>
                <div class="section">
                    <strong>${t.aplicacaoPratica}</strong>
                    <p>${data.aplicacao}</p>
                </div>
                <p class="oracao-final">${t.oracaoLabel} ${data.oracao}</p>
            `;
            
            document.getElementById('pageCounter').innerText = `P√°gina ${day} de ${totalDays}`; 

            // Reinicia o estado do bot√£o TTS
            updateListenToggle('start'); 
        }
        
        // --- FUN√á√ïES DE NAVEGA√á√ÉO (AGORA S√çNCRONAS) ---
        function nextDay() {
            stopSpeaking(); 
            if (currentDay < totalDays) {
                currentDay++;
                localStorage.setItem(`devotionalProgress_${DEVOTIONAL_KEY}`, currentDay);
                updateTexts(1);
            }
        }
        
        function prevDay() {
            stopSpeaking();
            if (currentDay > 1) {
                currentDay--;
                localStorage.setItem(`devotionalProgress_${DEVOTIONAL_KEY}`, currentDay);
                updateTexts(-1);
            }
        }

        // --- FUN√á√ïES DE LEITURA (TEXT-TO-SPEECH - ATUALIZADAS PARA CARREGAMENTO DE VOZES) ---
        
        function getVoiceForLanguage(langCode) {
            const desiredLang = langCode.toLowerCase();
            
            if (ttsVoices.length === 0) {
                 // Caso extremo: vozes n√£o carregadas
                console.warn('TTS: Vozes n√£o carregadas.');
                return null;
            }
            
            // 1. Tenta encontrar uma voz nativa (ex: Google, Microsoft) que case exatamente com o c√≥digo.
            let voice = ttsVoices.find(v => v.lang.toLowerCase() === desiredLang && v.localService);

            // 2. Se n√£o encontrar nativa, tenta encontrar qualquer voz que case exatamente com o c√≥digo.
            if (!voice) {
                voice = ttsVoices.find(v => v.lang.toLowerCase() === desiredLang);
            }

            // 3. Se ainda n√£o encontrar, tenta encontrar qualquer voz que comece com o mesmo prefixo (ex: pt-BR para pt-PT)
            if (!voice) {
                const langPrefix = desiredLang.substring(0, 2);
                voice = ttsVoices.find(v => v.lang.toLowerCase().startsWith(langPrefix));
            }

            // 4. Se ainda assim n√£o encontrar, retorna a primeira voz dispon√≠vel.
            return voice || ttsVoices[0];
        }

        function speakContent() {
            const t = translations[currentLang] || translations['pt-BR']; 
            const contentElement = document.getElementById('devotionalContent');
            
            if (!synth || synth.speaking) {
                // Se j√° estiver falando ou se a API n√£o estiver dispon√≠vel, para
                stopSpeaking();
                return;
            }

            const textToSpeak = contentElement.innerText || contentElement.textContent;

            if (!textToSpeak) {
                alert(t.noContentAlert || "Conte√∫do para leitura n√£o encontrado.");
                return;
            }

            totalChars = textToSpeak.length;
            resetAudioProgressBar();

            utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = currentLang;

            // ‚úÖ CORRE√á√ÉO: Define a voz para garantir que a leitura funcione
            const voice = getVoiceForLanguage(currentLang);
            if (voice) {
                utterance.voice = voice;
            } else {
                // Caso extremo: nenhuma voz encontrada.
                alert(t.ttsUnsupported + " " + t.noContentAlert);
                stopSpeaking();
                return;
            }
            
            utterance.onboundary = (event) => {
                const progress = (event.charIndex / totalChars) * 100;
                if (audioProgressBar) audioProgressBar.style.width = `${progress}%`;
            };
            
            utterance.onend = () => {
                resetAudioProgressBar(true);
                updateListenToggle('start'); 
            };
            
            synth.speak(utterance);
            updateListenToggle('speaking'); 
        }

        function stopSpeaking() {
            if (synth && synth.speaking) {
                synth.cancel();
            }
            resetAudioProgressBar(true); 
            // Garante que o estado visual do bot√£o seja reiniciado
            updateListenToggle('start'); 
        }
        
        function handleListenClick() {
            if (!synth || listenToggle.disabled) return;

            if (synth.speaking && !synth.paused) {
                // Se estiver falando, pausa (Bot√£o: PAUSAR -> CONTINUAR)
                synth.pause();
                updateListenToggle('paused');
            } 
            else if (synth.paused) {
                // Se estiver pausado, continua (Bot√£o: CONTINUAR -> PAUSAR)
                synth.resume();
                updateListenToggle('speaking');
            } 
            else if (!synth.speaking) {
                // Se estiver ocioso (estado 'start'), inicia a leitura
                speakContent();
            }
        }
        
        // NOVO: Fun√ß√£o de inicializa√ß√£o do TTS (CORRE√á√ÉO CR√çTICA)
        function initTTS() {
            if (ttsInitialized) return; // Garante que s√≥ rode uma vez
            const t = translations[currentLang] || translations['pt-BR']; 

            if (!synth) {
                listenToggle.innerHTML = t.ttsUnsupported;
                listenToggle.disabled = true;
                return;
            }

            // 1. Define o handler para o evento de mudan√ßa de vozes (ass√≠ncrono)
            // Este evento √© o que garante que a lista de vozes ser√° preenchida
            synth.onvoiceschanged = () => {
                ttsVoices = synth.getVoices();
                if (ttsVoices.length > 0) {
                    listenToggle.disabled = false;
                    updateListenToggle('start'); 
                    ttsInitialized = true;
                } else {
                    listenToggle.innerHTML = t.ttsUnsupported;
                    listenToggle.disabled = true;
                }
            };
            
            // 2. Tenta carregar as vozes imediatamente
            ttsVoices = synth.getVoices();
            
            if (ttsVoices.length > 0) {
                // S√≠ncrono: vozes j√° prontas na inicializa√ß√£o
                listenToggle.disabled = false;
                updateListenToggle('start');
                ttsInitialized = true;
                synth.onvoiceschanged = null; // Remove o listener se foi s√≠ncrono
            } else {
                // Ass√≠ncrono: mostra 'carregando' e espera pelo onvoiceschanged
                listenToggle.innerHTML = t.ttsLoading;
                listenToggle.disabled = true;
                // O onvoiceschanged definido no passo 1 ir√° habilitar o bot√£o
            }
        }


        function updateListenToggle(state = 'start') {
            const t = translations[currentLang] || translations['pt-BR']; 
            const button = listenToggle;
            if (!button) return;

            button.style.cssText = ''; 
            
            if (state === 'speaking') {
                button.innerHTML = t.listenPause || '‚è∏Ô∏è Pausar √Åudio';
                button.title = 'Pausar a leitura';
                button.style.backgroundColor = '#ffc107'; 
                button.style.color = '#333';
                
            } else if (state === 'paused') {
                button.innerHTML = t.listenResume || '‚ñ∂Ô∏è Continuar';
                button.title = 'Continuar a leitura';
                button.style.backgroundColor = '#28a745'; 
                button.style.color = 'white';
                
            } else { // state === 'start' (Ocioso/Parado)
                button.innerHTML = t.listenStart || 'üîä Ou√ßa Aqui';
                button.title = 'Iniciar a leitura do devocional';
            }
        }


       // --- CONTE√öDO DEVOCIONAL (MANTIDO) ---
        
        const devotionalContent = {
            1: {pt: {h2: "O √önico Evangelho Verdadeiro (Sola Gratia)", versiculos: "G√°latas 1:8-9 (NVI): Mas, ainda que n√≥s ou um anjo do c√©u pregue um evangelho diferente daquele que lhes pregamos, que seja an√°tema.", resumo: "G√°latas come√ßa com a defesa de que existe apenas um Evangelho, que √© a justifica√ß√£o pela f√© em Cristo, separada das obras da Lei (legalismo). Qualquer adi√ß√£o (como circuncis√£o ou observ√¢ncia ritual) que busque o m√©rito humano anula a gra√ßa de Cristo. Esta √© a doutrina da Gra√ßa Exclusiva (Sola Gratia): ou √© totalmente a Gra√ßa, ou n√£o √© Gra√ßa de forma alguma.", aplicacao: "Em quais √°reas voc√™ tem adicionado 'esfor√ßo humano' ou rituais √† obra completa de Cristo, buscando valida√ß√£o ou 'n√≠veis' mais altos de aceita√ß√£o por Deus? Descanse na sufici√™ncia de Cristo (Solus Christus).", oracao: "Ore a Deus agradecendo pela pureza do Evangelho. Pe√ßa ao Senhor que o livre de qualquer forma de legalismo ou autojustifica√ß√£o, renovando sua f√© na obra completa de Jesus."} , en: {h2: "The Only True Gospel (Sola Gratia)", versiculos: "Galatians 1:8-9 (NIV): But even if we or an angel from heaven should preach a gospel other than the one we preached to you, let them be under God's curse!", resumo: "Galatians begins with the defense that there is only one Gospel, which is justification by faith in Christ, separate from the works of the Law (legalism). Any addition (like circumcision or ritual observance) that seeks human merit nullifies the grace of Christ. This is the doctrine of Exclusive Grace (Sola Gratia): it is either entirely Grace, or it is no Grace at all.", aplicacao: "In what areas have you added 'human effort' or rituals to the complete work of Christ, seeking validation or 'higher levels' of acceptance by God? Rest in the sufficiency of Christ (Solus Christus).", oracao: "Pray to God, thanking Him for the purity of the Gospel. Ask the Lord to free you from any form of legalism or self-righteousness, renewing your faith in the completed work of Jesus."}, es: {h2: "The Only True Gospel (Sola Gratia)", versiculos: "Galatians 1:8-9 (NVI): Pero aun si nosotros o un √°ngel del cielo les predicara un evangelio diferente del que les hemos predicado, ¬°que caiga sobre √©l la maldici√≥n!", resumo: "G√°latas comienza con la defensa de que existe solo un Evangelio, que es la justificaci√≥n por la fe en Cristo, separada de las obras de la Ley (legalismo). Cualquier adici√≥n (como la circuncisi√≥n o la observancia ritual) que busque el m√©rito humano anula la gracia de Cristo. Esta es la doctrina de la Gracia Exclusiva (Sola Gratia): o es totalmente la Gracia, o no es Gracia en absoluto.", aplicacao: "¬øEn qu√© √°reas has a√±adido 'esfuerzo humano' o rituales a la obra completa de Cristo, buscando validaci√≥n o 'niveles' m√°s altos de aceptaci√≥n ante Dios? Descansa en la suficiencia de Cristo (Solus Christus).", oracao: "Ora a Dios agradeciendo por la pureza del Evangelio. Pide al Se√±or que te libere de cualquier forma de legalismo o autojustificaci√≥n, renovando tu fe en la obra completa de Jes√∫s."}, fr: {h2: "Le Seul V√©ritable √âvangile (Sola Gratia)", versiculos: "Galates 1:8-9 (Louis Segond): Mais, quand nous-m√™mes, quand un ange du ciel annoncerait un √âvangile diff√©rent de celui que nous vous avons annonc√©, qu'il soit anath√®me!", resumo: "Galates commence par la d√©fense qu'il n'existe qu'un seul √âvangile, qui est la justification par la foi en Christ, s√©par√©e des ≈ìuvres de la Loi (l√©galisme). Toute addition (comme la circision ou l'observance rituelle) qui cherche le m√©rite humain annule la gr√¢ce du Christ. C'est la doctrine de la Gr√¢ce Exclusive (Sola Gratia): soit c'est enti√®rement la Gr√¢ce, soit ce n'est pas la Gr√¢ce du tout.", aplicacao: "Dans quels domaines avez-vous ajout√© des 'efforts humains' ou des rituels √† l'≈ìuvre compl√®te du Christ, cherchant validation ou des 'niveaux' sup√©rieurs d'acceptation par Dieu? Reposez-vous dans la suffisance du Christ (Solus Christus).", oracao: "Priez Dieu le remerciant pour la puret√© de l'√âvangile. Demandez au Seigneur de vous lib√©rer de toute forme de l√©galisme ou d'auto-justification, renouvelant votre foi dans l'≈ìuvre achev√©e de J√©sus."}},
            2: {pt: {h2: "Crucificado e Vivendo Pela F√©", versiculos: "G√°latas 2:20 (NVI): Fui crucificado com Cristo. Assim, j√° n√£o sou eu quem vive, mas Cristo vive em mim. A vida que agora vivo no corpo, vivo-a pela f√© no Filho de Deus, que me amou e se entregou por mim.", resumo: "Esta √© a ess√™ncia da Identidade em Cristo. Pela f√© (Sola Fide), fomos unidos a Ele em Sua morte e ressurrei√ß√£o (Uni√£o com Cristo). Isso significa que nossa velha identidade (escrava do pecado e da Lei) morreu, e a nova vida que possu√≠mos √© a pr√≥pria vida de Cristo manifestada em n√≥s. Nossa vida n√£o √© mais sobre nossos esfor√ßos, mas sobre a f√© cont√≠nua Nele.", aplicacao: "O que sua vida revela hoje: o 'velho eu' tentando se justificar ou a 'nova vida' confiando na sufici√™ncia de Cristo? Proclame essa verdade sobre si mesmo: 'J√° n√£o sou eu quem vive.'", oracao: "Ore a Deus pedindo que a verdade da sua crucifica√ß√£o e ressurrei√ß√£o com Cristo se torne a base de todas as suas decis√µes e a fonte do seu poder para a santifica√ß√£o."}, en: {h2: "Crucified and Living By Faith", versiculos: "Galatians 2:20 (NIV): I have been crucified with Christ and I no longer live, but Christ lives in me. The life I now live in the body, I live by faith in the Son of God, who loved me and gave himself for me.", resumo: "This is the essence of Identity in Christ. By faith (Sola Fide), we have been united with Him in His death and resurrection (Union with Christ). This means that our old identity (slave to sin and the Law) has died, and the new life we possess is Christ's very life manifested in us. Our life is no longer about our efforts but about continuous faith in Him.", aplicacao: "What does your life reveal today: the 'old self' trying to justify itself or the 'new life' trusting in Christ's sufficiency? Proclaim this truth over yourself: 'I no longer live.'", oracao: "Pray to God asking that the truth of your crucifixion and resurrection with Christ becomes the basis of all your decisions and the source of your power for sanctification."}, es: {h2: "Crucified and Living By Faith", versiculos: "Galatians 2:20 (NVI): Con Cristo he sido crucificado, y ya no soy yo quien vive, sino que es Cristo quien vive en m√≠. Y la vida que ahora vivo en el cuerpo, la vivo por la fe en el Hijo de Dios, quien me am√≥ y dio su vida por m√≠.", resumo: "Esta es la esencia de la Identidad en Cristo. Por la fe (Sola Fide), hemos sido unidos a √âl en Su muerte y resurrecci√≥n (Uni√≥n con Cristo). Esto significa que nuestra antigua identidad (esclava del pecado y de la Ley) muri√≥, y la nueva vida que poseemos es la propia vida de Cristo manifestada en nosotros. Nuestra vida ya no se trata de nuestros esfuerzos, sino de la fe continua en √âl.", aplicacao: "¬øQu√© revela tu vida hoy: el 'viejo yo' tratando de justificarse o la 'nueva vida' confiando en la suficiencia de Cristo? Proclama esta verdad sobre ti mismo: 'Ya no soy yo quien vive'.", oracao: "Ora a Dios pidiendo que la verdad de tu crucifixi√≥n y resurrecci√≥n con Cristo se convierta en el fundamento de todas tus decisiones y la fuente de tu poder para la santificaci√≥n."}, fr: {h2: "Crucifi√© et Vivant Par la Foi", versiculos: "Galates 2:20 (Louis Segond): J'ai √©t√© crucifi√© avec Christ; et si je vis, ce n'est plus moi qui vis, c'est Christ qui vit en moi; si je vis maintenant dans la chair, je vis dans la foi au Fils de Dieu, qui m'a aim√© et qui s'est livr√© lui-m√™me pour moi.", resumo: "C'est l'essence de l'Identit√© en Christ. Par la foi (Sola Fide), nous avons √©t√© unis √† Lui dans Sa mort et Sa r√©surrection (Union avec Christ). Cela signifie que notre ancienne identit√© (esclave du p√©ch√© et de la Loi) est morte, et la nouvelle vie que nous poss√©dons est la vie m√™me du Christ manifest√©e en nous. Notre vie ne d√©pend plus de nos efforts, mais de la foi continue en Lui.", aplicacao: "Que r√©v√®le votre vie aujourd'hui: le 'vieil homme' qui essaie de se justifier ou la 'nouvelle vie' qui fait confiance √† la suffisance du Christ? Proclamez cette v√©rit√© sur vous-m√™me: 'Ce n'est plus moi qui vis'.", oracao: "Priez Dieu demandant que la v√©rit√© de votre crucifixion et r√©surrection avec Christ devienne le fondement de toutes vos d√©cisions et la source de votre puissance pour la sanctification."}},
            3: {pt: {h2: "A Loucura de Tentar o M√©rito Humano", versiculos: "G√°latas 3:3 (NVI): Voc√™s s√£o t√£o insensatos assim? Tendo come√ßado pelo Esp√≠rito, querem agora aperfei√ßoar-se pelo esfor√ßo pr√≥prio?", resumo: "Paulo confronta a incoer√™ncia do legalismo. Se a Justifica√ß√£o (o come√ßo) foi inteiramente pela gra√ßa por meio da f√©, a Santifica√ß√£o (o desenvolvimento) n√£o pode depender do esfor√ßo humano (obras). A tentativa de 'aperfei√ßoar-se pela carne' √© um insulto √† sufici√™ncia do Esp√≠rito Santo. Sufici√™ncia do Esp√≠rito.", aplicacao: "Quando voc√™ peca, sua primeira rea√ß√£o √© afastar-se de Deus e tentar 'consertar-se' antes de voltar? Isso √© tentar aperfei√ßoar-se pela carne. Em vez disso, corra imediatamente para Cristo, que √© tanto nosso Justificador quanto nosso Santificador.", oracao: "Ore a Deus pedindo que o Senhor o liberte do c√≠rculo vicioso de tentar ganhar o favor divino atrav√©s de boas obras. Pe√ßa ao Esp√≠rito Santo que o guie em cada passo da sua santifica√ß√£o."}, en: {h2: "The Folly of Attempting Human Merit", versiculos: "Galatians 3:3 (NIV): Are you so foolish? After beginning by the Spirit, are you now trying to finish by human effort?", resumo: "Paul confronts the inconsistency of legalism. If Justification (the beginning) was entirely by grace through faith, Santification (the development) cannot depend on human effort (works). The attempt to 'finish by the flesh' is an insult to the sufficiency of the Holy Spirit. Sufficiency of the Spirit.", aplicacao: "When you sin, is your first response to withdraw from God and try to 'fix yourself' before returning? That is trying to finish by the flesh. Instead, run immediately to Christ, who is both our Justifier and our Sanctifier.", oracao: "Pray to God asking the Lord to free you from the vicious cycle of trying to earn divine favor through good works. Ask the Holy Spirit to guide you in every step of your sanctification."}, es: {h2: "The Folly of Attempting Human Merit", versiculos: "Galatians 3:3 (NVI): ¬°Tan necios son? Despu√©s de haber comenzado con el Esp√≠ritu, ¬øpretenden perfeccionarse con sus propios esfuerzos?", resumo: "Pablo confronta la incoherencia del legalismo. Si la Justificaci√≥n (el comienzo) fue enteramente por gracia por medio de la fe, la Santificaci√≥n (el desarrollo) no puede depender del esfuerzo humano (obras). El intento de 'perfeccionarse con la carne' es un insulto a la suficiencia del Esp√≠ritu Santo. Suficiencia del Esp√≠ritu.", aplicacao: "Cuando pecas, ¬ølo primero que haces es alejarte de Dios e intentar 'arreglarte' antes de volver? Eso es intentar perfeccionarse con la carne. En su lugar, corre inmediatamente a Cristo, que es tanto nuestro Justificador como nuestro Santificador.", oracao: "Ora a Dios pidiendo que el Se√±or te libere del c√≠rculo vicioso de intentar ganar el favor divino mediante buenas obras. Pide al Esp√≠ritu Santo que te gu√≠e en cada paso de tu santificaci√≥n."}, fr: {h2: "La Folie d'Essayer le M√©rite Humain", versiculos: "Galates 3:3 (Louis Segond): Apr√®s avoir commenc√© par l'Esprit, voulez-vous maintenant finir par la chair?", resumo: "Paul confronte l'incoh√©rence du l√©galisme. Si la Justification (le commencement) a √©t√© enti√®rement par la gr√¢ce au moyen de la foi, la Sanctification (le d√©veloppement) ne peut pas d√©pendre de l'effort humain (≈ìuvres). La tentative de 'finir par la chair' est une insulte √† la suffisance du Saint-Esprit. Suffisance de l'Esprit.", aplicacao: "Dans quels domaines avez-vous ajout√© des 'efforts humains' ou des rituels √† l'≈ìuvre compl√®te du Christ, cherchant validation ou des 'niveaux' sup√©rieurs d'acceptation par Dieu? Reposez-vous dans la sufici√™ncia do Christ (Solus Christus).", oracao: "Priez Dieu demandant que le Seigneur vous lib√®re du cercle vicieux d'essayer de gagner la faveur divine par de bonnes ≈ìuvres. Demandez au Saint-Esprit de vous guider √† chaque √©tape de votre sanctification."}},
            4: {pt: {h2: "De Escravo a Filho Adotado", versiculos: "G√°latas 4:4-7 (NVI): (...) para que receb√™ssemos a ado√ß√£o de filhos. E, porque voc√™s s√£o filhos, Deus enviou o Esp√≠rito de seu Filho ao cora√ß√£o de voc√™s, e ele clama: ‚ÄúAba, Pai.‚Äù Assim, voc√™ j√° n√£o √© mais escravo, mas filho; e, por ser filho, Deus tamb√©m o tornou herdeiro.", resumo: "A obra de Cristo na 'plenitude do tempo' tinha um prop√≥sito: nos redimir da escravid√£o da Lei e nos conceder a Ado√ß√£o. O Esp√≠rito Santo (o 'penhor' da nossa heran√ßa) testifica em nossos cora√ß√µes que somos herdeiros de Deus. Sua Identidade mudou de servo ou escravo para Filho Pleno.", aplicacao: "Voc√™ vive sua vida di√°ria como um escravo que teme puni√ß√£o ou como um filho amado que busca agradar o Pai por amor? Sua heran√ßa est√° garantida; ela n√£o precisa ser conquistada. Viva com a confian√ßa e alegria de um herdeiro.", oracao: "Ore a Deus, com a ousadia que o Esp√≠rito lhe d√°, clamando 'Aba, Pai.' Agrade√ßa a Ele pelo dom da ado√ß√£o e pe√ßa que a certeza de ser filho Dele remova todo medo da sua vida."}, en: {h2: "From Slave to Adopted Son", versiculos: "Galatians 4:4-7 (NIV): (...) that we might receive adoption as sons. Because you are his sons, God sent the Spirit of his Son into our hearts, the Spirit who cries out, ‚ÄúAbba, Father.‚Äù So you are no longer a slave, but God‚Äôs child; and since you are his child, God has made you also an heir.", resumo: "Christ's work in the 'fullness of time' had one purpose: to redeem us from the slavery of the Law and grant us Adoption. The Holy Spirit (the 'down payment' of our inheritance) testifies in our hearts that we are God's heirs. Your Identity has changed from servant or slave to Full Son.", aplicacao: "Do you live your daily life as a slave who fears punishment or as a beloved child who seeks to please the Father out of love? Your inheritance is guaranteed; it does not need to be earned. Live with the confidence and joy of an heir.", oracao: "Pray to God, thanking Him for the gift of adoption and ask that the certainty of being His child removes all fear from your life."}, es: {h2: "From Slave to Adopted Son", versiculos: "Galatians 4:4-7 (NVI): (...) para que recibi√©ramos la adopci√≥n de hijos. Y, puesto que ya son hijos, Dios ha enviado a nuestros corazones el Esp√≠ritu de su Hijo, que clama: ¬´¬°Abba! ¬°Padre!¬ª As√≠ que ya no eres esclavo, sino hijo; y como eres hijo, Dios te ha hecho tambi√©n heredero.", resumo: "La obra de Cristo en la 'plenitud del tiempo' ten√≠a un prop√≥sito: redimirnos de la esclavitud de la Ley y concedernos la Adopci√≥n. El Esp√≠ritu Santo (la 'prenda' de nuestra herencia) testifica en nuestros corazones que somos herederos de Dios. Tu Identidad ha cambiado de sirviente o esclavo a Hijo Pleno.", aplicacao: "¬øVives tu vida diaria como un esclavo que teme el castigo o como un hijo amado que busca agradar al Padre por amor? Tu herencia est√° garantizada; no necesita ser ganada. Vive con la confianza y alegr√≠a de un heredero.", oracao: "Ora a Dios, con la audacia que el Esp√≠ritu te da, clamando '¬°Abba! ¬°Padre!'. Agrad√©cele por el don de la adopci√≥n y pide que la certeza de ser Su hijo elimine todo temor de tu vida."}, fr: {h2: "D'Esclave √† Fils Adopt√©", versiculos: "Galates 4:4-7 (Louis Segond): (...) afin que nous re√ßussions l'adoption. Et parce que vous √™tes fils, Dieu a envoy√© dans nos coeurs l'Esprit de son Fils, lequel crie: Abba! P√®re! Ainsi tu n'es plus esclave, mais fils; et si tu es fils, tu es aussi h√©ritier par la gr√¢ce de Dieu.", resumo: "L'≈ìuvre du Christ dans la 'pl√©nitude des temps' avait un but: nous racheter de l'esclavage de la Loi et nous accorder l'Adoption. Le Saint-Esprit (le 'gage' de notre h√©ritage) t√©moigne dans nos c≈ìurs que nous sommes h√©ritiers de Dieu. Votre Identit√© a chang√© de serviteur ou d'esclave √† Fils Pl√©nier.", aplicacao: "Vivez-vous votre vie quotidienne comme un esclave qui craint la punition ou comme un enfant bien-aim√© qui cherche √† plaire au P√®re par amour? Votre h√©ritage est garanti; il n'a pas besoin d'√™tre gagn√©. Vivez avec la confiance et la joie d'un h√©ritier.", oracao: "Priez Dieu demandant que la v√©rit√© de votre crucifixion et r√©surrection avec Christ devienne le fondement de toutes vos d√©cisions et la source de votre puissance pour la sanctification."}},
            5: {pt: {h2: "Permanecendo Firmes na Liberdade", versiculos: "G√°latas 5:1 (NVI): Foi para a liberdade que Cristo nos libertou. Portanto, permane√ßam firmes e n√£o se deixem submeter novamente a um jugo de escravid√£o.", resumo: "A Liberdade em Cristo √© a liberta√ß√£o do jugo da Lei como meio de justifica√ß√£o e do poder do pecado. Essa liberdade √© um presente a ser ativamente guardado. O legalismo (voltar para debaixo da Lei) √© uma forma de escravid√£o que rouba a paz e a alegria da Sola Fide. Manter essa liberdade √© a ess√™ncia da perseveran√ßa crist√£.", aplicacao: "Quais s√£o os 'jugos de escravid√£o' (regras humanas, expectativas irrealistas, medo de falhar) que a cultura religiosa tenta lhe impor? Rejeite-os. Use sua liberdade para servir uns aos outros em amor, e n√£o para satisfazer a carne.", oracao: "Ore a Deus agradecendo pela liberdade que Cristo conquistou. Pe√ßa sabedoria para usar essa liberdade para a gl√≥ria Dele e for√ßa para resistir a qualquer jugo de escravid√£o legalista."}, en: {h2: "Standing Firm in Freedom", versiculos: "Galatians 5:1 (NIV): It is for freedom that Christ has set us free. Stand firm, then, and do not let yourselves be burdened again by a yoke of slavery.", resumo: "The Freedom in Christ is liberation from the yoke of the Law as a means of justification and from the power of sin. This freedom is a gift to be actively guarded. Legalism (going back under the Law) is a form of slavery that steals the peace and joy of Sola Fide. Maintaining this freedom is the essence of Christian perseverance.", aplicacao: "What 'yokes of slavery' (human rules, unrealistic expectations, fear of failure) does religious culture try to impose on you? Reject them. Use your freedom to serve one another in love, not to satisfy the flesh.", oracao: "Pray to God, thanking Him for the freedom Christ won. Ask for wisdom to use that freedom for His glory and strength to resist any yoke of legalistic slavery."}, es: {h2: "Standing Firm in Freedom", versiculos: "Galatians 5:1 (NVI): Cristo nos libert√≥ para que vivamos en libertad. Por lo tanto, mant√©nganse firmes y no se sometan nuevamente al yugo de la esclavitud.", resumo: "La Libertad en Cristo es la liberaci√≥n del yugo de la Ley como medio de justificaci√≥n y del poder del pecado. Esta libertad es un regalo que debe ser guardado activamente. El legalismo (volver bajo la Ley) es una forma de esclavitud que roba la paz y la alegr√≠a de la Sola Fide. Mantener esta libertad es la esencia de la perseverancia cristiana.", aplicacao: "¬øCu√°les son los 'yugos de esclavitud' (reglas humanas, expectativas irrealistas, miedo al fracaso) que la cultura religiosa intenta imponerte? Rech√°zalos. Usa tu libertad para servirte los unos a los otros en amor, y no para satisfacer la carne.", oracao: "Ora a Dios agradeciendo por la libertad que Cristo conquist√≥. Pide sabidur√≠a para usar esa libertad para Su gloria y fuerza para resistir cualquier yugo de esclavitud legalista."}, fr: {h2: "Demeurer Ferme dans la Libert√©", versiculos: "Galates 5:1 (Louis Segond): C'est pour la libert√© que Christ nous a affranchis. Demeurez donc fermes, et ne vous laissez pas mettre de nouveau sous le joug de la servitude.", resumo: "La Libert√© en Christ est la lib√©ration du joug de la Loi como meio de justifica√ß√£o et do poder do pecado. Cette libert√© est un don √† garder activement. Le l√©galisme (se remettre sous la Loi) est un forme d'esclavage qui vole la paix et la joie de la Sola Fide. Maintenir cette libert√© est l'essence de la pers√©v√©rance chr√©tienne.", aplicacao: "Quels sont les 'jougs de la servitude' (r√®gles humaines, attentes irr√©alistes, peur de l'√©chec) que la culture religieuse tente de vous imposer? Rejetez-les. Utilisez votre libert√© pour vous servir les uns les autres dans l'amour, et non pour satisfaire la chair.", oracao: "Priez Dieu demandant que le Seigneur vous lib√®re du cercle vicieux d'essayer de gagner la faveur divine par de bonnes obras. Demandez ao Saint-Esprit de vous guider √† chaque √©tape de sua santifica√ß√£o."}},
            6: {pt: {h2: "A Luta Entre a Carne e o Esp√≠rito", versiculos: "G√°latas 5:16-17 (NVI): Por isso digo: vivam pelo Esp√≠rito, e de modo nenhum satisfar√£o os desejos da carne. Pois a carne deseja o que √© contr√°rio ao Esp√≠rito, e o Esp√≠rito, o que √© contr√°rio √† carne.", resumo: "A vida crist√£ √© uma Guerra Espiritual di√°ria. O crente (agora justificado) tem duas naturezas em conflito: a carne (o remanescente pecaminoso) e o Esp√≠rito (a nova natureza dada na Regenera√ß√£o). O segredo da Santifica√ß√£o progressiva n√£o √© a for√ßa de vontade, mas Andar pelo Esp√≠rito, submetendo-se ativamente ao Seu controle.", aplicacao: "O que significa 'viver pelo Esp√≠rito' na sua rotina hoje? √â cultivar as disciplinas espirituais (leitura da B√≠blia, ora√ß√£o, comunh√£o) n√£o por obriga√ß√£o, mas para obter a 'pot√™ncia' de que voc√™ precisa para resistir aos desejos da carne. Que obras da carne voc√™ precisa identificar e confrontar?", oracao: "Ore a Deus confessando sua depend√™ncia. Pe√ßa ao Esp√≠rito Santo que discipline seu cora√ß√£o e lhe d√™ o poder di√°rio para negar a si mesmo e viver uma vida de obedi√™ncia radical."}, en: {h2: "The Conflict Between the Flesh and the Spirit", versiculos: "Galatians 5:16-17 (NIV): So I say, walk by the Spirit, and you will not gratify the desires of the flesh. For the flesh desires what is contrary to the Spirit, and the Spirit what is contrary to the flesh.", resumo: "The Christian life is a daily Spiritual War. The believer (now justified) has two conflicting natures: the flesh (the sinful remnant) and the Spirit (the new nature given in Regeneration). The secret to progressive Sanctification is not willpower but to Walk by the Spirit, actively submitting to His control.", aplicacao: "What does your life reveal today: the 'old self' trying to justify itself or the 'new life' trusting in Christ's sufficiency? Proclaim this truth over yourself: 'I no longer live.'", oracao: "Pray to God, confessing your dependence. Ask the Holy Spirit to discipline your heart and give you the daily power to deny yourself and live a life of radical obedience."}, es: {h2: "The Conflict Between the Flesh and the Spirit", versiculos: "Galatians 5:16-17 (NVI): As√≠ que les digo: Vivan por el Esp√≠ritu, y as√≠ no satisfar√°n los deseos de la naturaleza pecaminosa. Porque esta desea lo que es contrario al Esp√≠ritu, y el Esp√≠ritu lo que es contrario a ella.", resumo: "La vida cristiana es una Guerra Espiritual diaria. El creyente (ahora justificado) tiene dos naturalezas en conflicto: la carne (el remanente pecaminoso) y el Esp√≠ritu (la nueva naturaleza dada en la Regeneraci√≥n). El secreto de la Santificaci√≥n progresiva no es la fuerza de voluntad, sino Andar por el Esp√≠ritu, someti√©ndose activamente a Su control.", aplicacao: "¬øQu√© significa 'vivir por el Esp√≠ritu' en tu rutina hoy? Es cultivar las disciplinas espirituales (lectura de la Biblia, oraci√≥n, comuni√≥n) no por obligaci√≥n, sino para obtener el 'poder' que necesitas para resistir los deseos de la carne. ¬øQu√© obras de la carne necesitas identificar y confrontar?", oracao: "Ora a Dios confesando tu dependencia. Pide al Esp√≠ritu Santo que discipline tu coraz√≥n y te d√© el poder diario para negarte a ti mismo y vivir una vida de obediencia radical."}, fr: {h2: "Le Conflit Entre la Chair et l'Esprit", versiculos: "Galates 5:16-17 (Louis Segond): Je dis donc: Marchez selon l'Esprit, et vous n'accomplirez point les d√©sirs de la chair. Car la chair a des d√©sirs contraires √† ceux de l'Esprit, et l'Esprit en a de contraires √† ceux de la chair.", resumo: "La vie chr√©tienne est une Guerre Spirituelle quotidienne. Le crente (agora justifi√©) tem duas naturezas em conflito: a carne (o remanescente pecaminoso) e o Esp√≠rito (a nova natureza dada na Regenera√ß√£o). O segredo da Santifica√ß√£o progressiva n√£o √© a for√ßa de vontade, mas Marcher selon l'Esprit, en se soumettant activement √† Son contr√¥le.", aplicacao: "Que signifie 'marcher selon l'Esprit' dans votre routine aujourd'hui? C'est cultiver les disciplines spirituelles (lecture de la Bible, pri√®re, communion) non par obligation, mais pour obtenir la 'puissance' dont vous avez besoin pour r√©sister aux d√©sirs de la chair. Quelles ≈ìuvres de la chair devez-vous identifier et confronter?", oracao: "Priez Dieu demandant que le Seigneur vous lib√®re du cercle vicieux d'essayer de gagner la faveur divine par de bonnes obras. Demandez ao Saint-Esprit de vous guider √† cada etapa de sua santifica√ß√£o."}},
            7: {pt: {h2: "O Fruto da Vida Dirigida pelo Esp√≠rito", versiculos: "G√°latas 5:22-25 (NVI): Mas o fruto do Esp√≠rito √© amor, alegria, paz, paci√™ncia, amabilidade, bondade, fidelidade, mansid√£o e dom√≠nio pr√≥prio. (...) Uma vez que vivemos pelo Esp√≠rito, sigamos tamb√©m o Esp√≠rito.", resumo: "O Fruto (singular) √© a manifesta√ß√£o vis√≠vel da nova vida em Cristo. √â um resultado org√¢nico de Andar pelo Esp√≠rito, e n√£o uma lista de obras que tentamos produzir por n√≥s mesmos. Essa lista de virtudes √© a pr√≥pria natureza de Cristo. O crist√£o justificado deve seguir tamb√©m o Esp√≠rito (*stoichƒìo* em grego), permitindo que Ele produza o Seu car√°ter em n√≥s. Evid√™ncia da Regenera√ß√£o.", aplicacao: "Olhe para a lista dos Frutos: qual deles est√° mais evidente em sua vida e qual precisa ser buscado com mais depend√™ncia do Esp√≠rito? Lembre-se, o objetivo n√£o √© tentar amar, mas andar no Esp√≠rito, permitindo que Ele produza o Amor em voc√™.", oracao: "Ore a Deus pedindo que o Esp√≠rito Santo o encha de tal maneira que o Seu fruto seja evidente. Pe√ßa a Ele que o ajude a 'seguir o passo' em obedi√™ncia, para a gl√≥ria de Deus."}, en: {h2: "The Fruit of the Spirit-Led Life", versiculos: "Galatians 5:22-25 (NIV): But the fruit of the Spirit is love, joy, peace, forbearance, kindness, goodness, faithfulness, gentleness and self-control. (...) Since we live by the Spirit, let us keep in step with the Spirit.", resumo: "The Fruit (singular) is the visible manifestation of the new life in Christ. It is an organic result of Walking by the Spirit, not a list of works we try to produce by ourselves. This list of virtues is the very nature of Christ. The justified Christian must keep in step with the Spirit (*stoichƒìo* in Greek), allowing Him to produce His character in us. Evidence of Regeneration.", aplicacao: "Look at the list of Fruits: which one is most evident in your life, and which one needs to be sought with more dependence on the Spirit? Remember, the goal is not to try to love, but to walk in the Spirit, allowing Him to produce Love in you.", oracao: "Pray to God, asking the Holy Spirit to fill you in such a way that His fruit is evident. Ask Him to help you 'keep in step' in obedience, for the glory of God."}, es: {h2: "The Fruit of the Spirit-Led Life", versiculos: "Galatians 5:22-25 (NVI): En cambio, el fruto del Esp√≠ritu es amor, alegr√≠a, paz, paciencia, amabilidad, bondad, fidelidad, mansedumbre y dominio propio. (...) Ya que vivimos por el Esp√≠ritu, dej√©monos guiar por el Esp√≠ritu.", resumo: "El Fruto (singular) es la manifestaci√≥n visible de la nueva vida en Cristo. Es un resultado org√°nico de Andar en el Esp√≠ritu, no una lista de obras que intentamos producir por nosotros mismos. Esta lista de virtudes es la naturaleza misma de Cristo. El cristiano justificado debe dejarse guiar por el Esp√≠ritu (*stoichƒìo* en griego), permitiendo que √âl produzca Su car√°cter en nosotros. Evidencia de la Regeneraci√≥n.", aplicacao: "Mira la lista de los Frutos: ¬øcu√°l es el m√°s evidente en tu vida y cu√°l necesita ser buscado con m√°s dependencia del Esp√≠ritu? Recuerda, el objetivo no es intentar amar, sino andar en el Esp√≠ritu, permitiendo que √âl produzca el Amor en ti.", oracao: "Ora a Dios pidiendo que el Esp√≠ritu Santo te llene de tal manera que Su fruto sea evidente. P√≠dele que te ayude a 'mantener el paso' en obediencia, para la gloria de Dios."}, fr: {h2: "Le Fruit de la Vie Dirig√©e par l'Esprit", versiculos: "Galates 5:22-25 (Louis Segond): Mais le fruit de l'Esprit est l'amour, la joie, la paix, la patience, la bont√©, la b√©nignit√©, la fid√©lit√©, la douceur, la temp√©rance. (...) Si nous vivons par l'Esprit, marchons aussi selon l'Esprit.", resumo: "Le Fruit (singulier) est la manifestation visible de la nouvelle vie en Christ. Il est un resultado org√¢nico de Marcher selon l'Esprit, non une lista de obras que n√≥s tentamos produzir por n√≥s mesmos. Essa lista de virtudes √© a natureza mesma do Cristo. O crist√£o justificado deve marcher aussi selon l'Esprit (*stoichƒìo* em grego), Lui permettant de produire Son caract√®re en nous. Preuve de la R√©g√©n√©ration.", aplicacao: "Regardez la liste des Fruits: lequel est le plus √©vident dans votre vie et lequel doit √™tre recherch√© avec plus de d√©pendance √† l'Esprit? Rappelez-vous, le but n'est pas d'essayer d'aimer, mas de marcher dans l'Esprit, Lui permettant de produire l'Amour em vous.", oracao: "Priez Dieu demandant que le Seigneur vous lib√®re du cercle vicieux d'essayer de gagner la faveur divine par de bonnes obras. Demandez ao Saint-Esprit de vous guider √† cada etapa de sua santifica√ß√£o."}}
        };

        // FIM DO CONTE√öDO DEVOCIONAL

        // * FUN√á√ïES DE PERSIST√äNCIA E ESTADO (MANTIDAS) *
        
        function getSavedProgress() {
            const savedDay = localStorage.getItem(`devotionalProgress_${DEVOTIONAL_KEY}`);
            return savedDay ? parseInt(savedDay, 10) : 1;
        }

        function getCompletedDays() {
            const completed = localStorage.getItem(`completedDays_${DEVOTIONAL_KEY}`);
            return completed ? JSON.parse(completed) : {};
        }

        function saveCompletion(day, isChecked) {
            const key = `completedDays_${DEVOTIONAL_KEY}`;
            const completedDays = getCompletedDays();
            completedDays[day] = isChecked;
            localStorage.setItem(key, JSON.stringify(completedDays));
            updateOverallProgress();
        }

        function updateCompletedState() {
            const completedDaysMap = getCompletedDays();
            completedCheck.checked = completedDaysMap[currentDay] || false;
        }

        function updateOverallProgress() {
            const completedDaysMap = getCompletedDays();
            const completedCount = Object.values(completedDaysMap).filter(v => v).length;
            const percent = (completedCount / totalDays) * 100;
            progressBar.style.width = `${percent}%`;
            prevButton.disabled = currentDay <= 1;
            nextButton.disabled = currentDay >= totalDays;
            
            updateCompletedState();
        }

        // * EXECU√á√ÉO PRINCIPAL (INICIALIZA√á√ÉO) *
       window.onload = () => {
    
    // üö® LIMPEZA FOR√áADA DAS CHAVES ANTIGAS (MANTIDA)
    localStorage.removeItem('completedDays'); 
    localStorage.removeItem('devotionalProgress');
    
    // 1. Carrega o tema e idioma
    loadThemePreference(); 
    updateLanguageSelector();
               
    // 2. Carrega o dia salvo e atualiza a UI
    currentDay = getSavedProgress();
    updateTexts(0); 
    
    // 3. Configura o TTS (CORRE√á√ÉO CR√çTICA)
    initTTS(); // Chamada √∫nica na inicializa√ß√£o da p√°gina

    // 4. Configura os Listeners de Eventos
    themeToggle.addEventListener('click', toggleDarkMode);
    
    if (listenToggle) {
        // ‚úÖ Usa o controlador de clique √∫nico com a nova l√≥gica de estado
        listenToggle.addEventListener('click', handleListenClick); 
    }
    
    // Listeners do Seletor de Idioma
    langSelectButton.addEventListener('click', (event) => {
        event.stopPropagation();
        langDropdown.style.display = langDropdown.style.display === 'block' ? 'none' : 'block';
    });
    document.addEventListener('click', (event) => {
        const wrapper = document.querySelector('.language-selector-wrapper');
        if (langDropdown.style.display === 'block' && !wrapper.contains(event.target)) {
            langDropdown.style.display = 'none';
        }
    });

    prevButton.addEventListener('click', prevDay);
    nextButton.addEventListener('click', nextDay);
    completedCheck.addEventListener('change', handleCompletedCheck);
};
        
    </script>
</body>
</html>