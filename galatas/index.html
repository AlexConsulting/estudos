<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7 Dias: A Sufici√™ncia de Cristo (Devocional)</title>
    <style>
        /* 0. NOVO: Vari√°vel CSS para controle de Zoom/Fonte */
        :root {
            --base-font-scale: 1.0; /* Valor padr√£o para 100% */
        }
        
        /* 1. CSS PRINCIPAL (LIGHT THEME - PADR√ÉO) */
        body {
            font-family: 'Georgia', serif;
            margin: 0;
            background-color: #e6e0d3; /* Papel envelhecido */
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px 0; 
            transition: background-color 0.3s, color 0.3s;
        }
        .book-container {
            max-width: 650px;
            width: 90%;
            background: #fdfdfd;
            padding: 30px 40px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid #ccc;
            position: relative;
            transition: background 0.3s, box-shadow 0.3s;
            /* NOVO: Aplica o zoom/escala */
            font-size: calc(var(--base-font-scale) * 1em); 
        }
        h1 {
            color: #4b0082;
            text-align: center;
            font-family: 'Times New Roman', serif;
            border-bottom: 2px solid #4b0082;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            font-style: italic;
            margin-bottom: 20px;
            color: #555;
            font-size: 0.95em;
        }
        h2 {
            color: #007bff;
            font-size: 1.5em;
            text-align: center;
            margin-top: 10px;
            margin-bottom: 20px;
        }
        .versiculos {
            font-style: italic;
            background-color: #f0f8ff;
            padding: 15px;
            border-left: 5px solid #28a745;
            margin: 15px 0;
            font-weight: 500;
        }
        .section {
            margin-top: 20px;
            padding: 10px;
            border-bottom: 1px dashed #ddd;
        }
        .section strong {
            display: block;
            color: #dc3545;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .oracao-final {
            margin-top: 25px;
            padding: 15px;
            background-color: #fffae0;
            border-left: 5px solid #ffc107;
            font-weight: bold;
            text-align: center;
            font-style: italic;
        }
        
        /* 2. NAVEGA√á√ÉO E UTILS */
        .top-utils {
            display: flex;
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap; 
            gap: 8px; /* AJUSTE: Reduzido o espa√ßamento padr√£o */
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            flex-wrap: wrap; 
            gap: 15px; 
        }
        
        /* ESTILO PADR√ÉO DOS BOT√ïES DE NAVEGA√á√ÉO (Anterior/Pr√≥ximo) */
        .nav-button {
            padding: 10px 15px;
            cursor: pointer;
            border: 1px solid #007bff;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            transition: opacity 0.2s, background 0.2s, border-color 0.2s;
        }
        .nav-button:disabled {
            opacity: 0.5;
            cursor: default;
        }
        
        /* NOVO: Indicador de Foco de Alto Contraste para Acessibilidade */
        button:focus, a:focus, input:focus, #accessibilityFloater button:focus {
            outline: 3px solid #00ff73; /* Cor vibrante */
            outline-offset: 2px;
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.5); /* Sombra para melhorar o contraste */
        }

        /* 3. DARK THEME CSS */
        .dark-theme {
            background-color: #121212;
            color: #f4f4f4;
        }
        .dark-theme .book-container {
            background: #1e1e1e;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            border-color: #333;
        }
        .dark-theme h1 {
            color: #bb86fc;
            border-bottom-color: #bb86fc;
        }
        .dark-theme .subtitle {
            color: #aaa;
        }
        .dark-theme h2 {
            color: #03dac6;
        }
        .dark-theme .versiculos {
            background-color: #2c2c2c;
            border-left-color: #03dac6;
        }
        .dark-theme .section {
            border-bottom-color: #444;
        }
        .dark-theme .section strong {
            color: #cf6679;
        }
        .dark-theme .oracao-final {
            background-color: #33331c;
            border-left-color: #ffd600;
        }
        
        /* Tema: Botoes de Navega√ß√£o escuros (Anterior/Pr√≥ximo) */
        .dark-theme .nav-button {
            background-color: #03dac6;
            border-color: #03dac6;
            color: #1e1e1e;
        }
        
        /* 4. SELETOR DE IDIOMA, LEITURA E TEMA (FUNDO NEUTRO UNIFICADO) */
        .language-selector-wrapper {
            position: relative;
            display: inline-block;
            z-index: 10;
        }

        /* Aplicando o estilo de fundo neutro para o seletor de idiomas, bot√£o de tema E bot√£o de escuta */
        #langSelectButton, #themeToggle, #listenToggle { 
            /* ESTILO NEUTRO UNIFICADO: Cinza Claro */
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            color: #333;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 0.9em;
            font-weight: bold; 
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        
        #listenToggle[disabled] {
            opacity: 0.6;
            cursor: wait;
        }

        #langSelectButton:hover, #themeToggle:hover, #listenToggle:hover:not([disabled]) {
            background-color: #e0e0e0;
        }

        .lang-flag-active {
            width: 24px;
            height: 18px;
            margin-right: 8px;
            border: 1px solid #ddd;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #langDropdown {
            display: none; 
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 150px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        #langDropdown a {
            color: #333;
            padding: 10px 15px;
            text-decoration: none;
            display: flex;
            align-items: center;
            font-size: 0.9em;
        }

        #langDropdown a:hover {
            background-color: #f5f5f5;
        }

        .lang-flag-dropdown {
            width: 20px;
            height: 15px;
            margin-right: 10px;
            border: 1px solid #eee;
        }

        /* Ajustes de Tema Escuro para Bot√µes de Utilidade (UNIFICADOS) */
        .dark-theme #langSelectButton, .dark-theme #themeToggle, .dark-theme #listenToggle {
            background-color: #2c2c2c;
            border-color: #444;
            color: #f4f4f4;
        }
        
        .dark-theme #langSelectButton:hover, .dark-theme #themeToggle:hover, .dark-theme #listenToggle:hover:not([disabled]) {
            background-color: #333;
        }


        .dark-theme #langDropdown {
            background-color: #1e1e1e;
            border-color: #444;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .dark-theme #langDropdown a {
            color: #f4f4f4;
        }

        .dark-theme #langDropdown a:hover {
            background-color: #333;
        }
        
        /* 5. MEDIA QUERIES (Ajustes para Celular) */
        @media (max-width: 600px) {
            .book-container {
                padding: 20px 25px; 
                width: 95%; 
            }
            .top-utils {
                /* flex-direction: column; <--- REMOVIDO para alinhar horizontalmente */
                /* align-items: flex-start; <--- REMOVIDO */
                justify-content: space-between; /* Distribui os itens para ocupar a largura */
                gap: 5px; /* Reduz o gap no mobile */
            }
            
            /* NOVO: Garante que os bot√µes de utilidade se ajustem e fiquem lado a lado */
            #langSelectButton, #themeToggle, #listenToggle {
                flex-grow: 1; /* Permite que o bot√£o cres√ßa para preencher o espa√ßo dispon√≠vel. */
                text-align: center; 
                justify-content: center; /* Centraliza o conte√∫do (incluindo bandeira/√≠cones) */
                padding: 8px 5px; /* Ajuste de padding para caber */
            }

            .navigation {
                flex-direction: column; 
                gap: 10px; 
            }
            .nav-button {
                width: 100%; 
            }
             
            .progress-check { 
                order: -1; 
                width: 100%; 
            }
        }
        
        /* 6. ESTILOS DA BARRA DE PROGRESSO E CHECKBOX (mantidos) */
        .progress-bar-wrapper {
            background-color: #ddd;
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .progress-bar {
            height: 100%;
            width: 0%; 
            background-color: #28a745;
            border-radius: 10px;
            transition: width 0.5s ease-in-out;
        }
        
        .dark-theme #progressLabel {
            color: #03dac6;
        }

        .dark-theme .progress-bar-wrapper {
            background-color: #333;
        }

        .dark-theme .progress-bar {
            background-color: #03dac6;
        }
        
        .progress-check {
             display: flex;
             align-items: center;
             justify-content: center;
             margin: 0;
             flex-grow: 0;
             flex-shrink: 0;
             padding: 5px 10px;
             background-color: #e6f7ff; 
             border: 1px solid #b3e0ff;
             border-radius: 5px;
             transition: background-color 0.3s;
             order: 0;
        }
        .progress-check label {
            margin-left: 10px;
            font-weight: bold;
            color: #1e8449;
            cursor: pointer;
        }
        .progress-check input[type="checkbox"] {
            transform: scale(1.3);
            cursor: pointer;
        }
        
        .dark-theme .progress-check {
            background-color: #2c2c2c;
            border-color: #444;
        }
        .dark-theme .progress-check label {
            color: #03dac6;
        }

        /* Estilos Espec√≠ficos da Barra de Progresso do √Åudio */
        #audioProgressContainer {
            height: 5px;
            width: 100%;
            background-color: #ddd; 
            border-radius: 2px;
            overflow: hidden;
            margin-top: 5px; 
            margin-bottom: 10px; 
        }
        #audioProgressBar {
            height: 100%;
            width: 0%;
            background-color: #ffc107; 
            transition: width 0.1s linear; 
        }

        .dark-theme #audioProgressContainer {
            background-color: #333;
        }
        .dark-theme #audioProgressBar {
            background-color: #ffd600; 
        }

        /* NOVO: Estilos do Menu de Acessibilidade Flutuante */
        #accessibilityFloater {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex; 
            flex-direction: column;
            z-index: 1000;
            padding: 8px 5px;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #accessibilityFloater button {
            padding: 5px 8px;
            margin: 5px 0;
            cursor: pointer;
            border: 1px solid #007bff;
            background-color: #f0f0f0;
            color: #333;
            font-weight: bold;
            font-size: 1.1em;
            border-radius: 5px;
            transition: background-color 0.2s;
        }

        #accessibilityFloater button:hover {
            background-color: #e0e0e0;
        }

        /* Ajustes para Tema Escuro */
        .dark-theme #accessibilityFloater {
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid #444;
        }

        .dark-theme #accessibilityFloater button {
            background-color: #2c2c2c;
            color: #f4f4f4;
            border-color: #03dac6;
        }
        .dark-theme #accessibilityFloater button:hover {
            background-color: #383838;
        }

        /* MEDIA QUERY: Esconde em telas muito pequenas se for muito intrusivo */
        @media (max-width: 400px) {
            #accessibilityFloater {
                right: 5px;
                padding: 5px;
            }
        }
    </style>
</head>
<body class="light-theme">

    <div id="accessibilityFloater" title="Controles de Acessibilidade">
        <button id="fontSizeIncrease" title="Aumentar Tamanho da Fonte">A+</button>
        <button id="fontSizeDecrease" title="Diminuir Tamanho da Fonte">A-</button>
    </div>
    <main>
        <div class="book-container">
            <div class="top-utils">
                <div class="language-selector-wrapper">
                    <button id="langSelectButton" aria-haspopup="true" aria-expanded="false" title="Selecionar Idioma">
                        </button>
                    <div id="langDropdown" role="menu">
                        </div>
                </div>
                
                <button id="listenToggle" class="nav-button" title="Ouvir Conte√∫do" disabled>
                    </button>
                
                <button id="themeToggle" class="nav-button" title="Mudar Tema">
                    </button>
            </div>
            
            <div id="audioProgressContainer" style="display: none;">
                <div id="audioProgressBar" class="progress-bar"></div>
            </div>

            <h1 id="mainTitle">7 Dias: A Sufici√™ncia de Cristo (Livro de G√°latas) </h1>
            <p class="subtitle" id="subTitle">Uma caminhada de gra√ßa, identidade e liberdade.</p>
            
            <div id="progressContainer" style="margin-bottom: 15px;">
                <p id="progressLabel" style="text-align: center; font-size: 0.9em; margin-bottom: 5px; color: #4b0082; font-weight: bold;"></p>
                <div class="progress-bar-wrapper">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
            </div>
            <p id="pageCounter" style="text-align: right;"></p>
            
            <div id="devotionalContent">
                </div>

            <div class="navigation">
                <button id="prevButton" class="nav-button" disabled>‚Üê Anterior</button>
                
                <div class="progress-check">
                    <input type="checkbox" id="completedCheck">
                    <label for="completedCheck" id="checkLabel">Marcar como Conclu√≠do</label>
                </div>
                
                <button id="nextButton" class="nav-button">Pr√≥ximo ‚Üí</button>
            </div>
        </div>
    </main>
    <footer>
        <p>Devocional adaptado e criado por Alex Silva | <span id="footerText"></span></p>
    </footer>

    <script>
        // --- DADOS MULTI-IDIOMA E TEMA ---
        const flagMap = {
            'pt-BR': { icon: '<img src="https://flagicons.lipis.dev/flags/4x3/br.svg" class="lang-flag-dropdown" alt="Portugu√™s">', text: 'Portugu√™s', iconActive: '<img src="https://flagicons.lipis.dev/flags/4x3/br.svg" class="lang-flag-active" alt="Portugu√™s">' },
            'en-US': { icon: '<img src="https://flagicons.lipis.dev/flags/4x3/us.svg" class="lang-flag-dropdown" alt="English">', text: 'English', iconActive: '<img src="https://flagicons.lipis.dev/flags/4x3/us.svg" class="lang-flag-active" alt="English">' },
            'es-ES': { icon: '<img src="https://flagicons.lipis.dev/flags/4x3/es.svg" class="lang-flag-dropdown" alt="Espa√±ol">', text: 'Espa√±ol', iconActive: '<img src="https://flagicons.lipis.dev/flags/4x3/es.svg" class="lang-flag-active" alt="Espa√±ol">' },
            'fr-FR': { icon: '<img src="https://flagicons.lipis.dev/flags/4x3/fr.svg" class="lang-flag-dropdown" alt="Fran√ßais">', text: 'Fran√ßais', iconActive: '<img src="https://flagicons.lipis.dev/flags/4x3/fr.svg" class="lang-flag-active" alt="Fran√ßais">' }
        };
        
        const themeMap = {
            'light': { icon: '‚òÄÔ∏è', next: 'dark' },
            'dark': { icon: 'üåô', next: 'light' }
        };

        const SAVED_THEME = localStorage.getItem('theme') || 'light'; 
        const SAVED_LANG = localStorage.getItem('language') || 'pt-BR'; 

        let currentTheme = SAVED_THEME;
        
        // --- VARI√ÅVEIS DE ESTADO ---
        const totalDays = 7;
        let currentDay = 1;
        let currentLang = SAVED_LANG; 
        
        // NOVO TTS: Objetos da Web Speech API e vari√°veis de controle
        const synth = window.speechSynthesis; 
        let utterance = null; 
        let totalChars = 0; // Para calcular o progresso
        let ttsVoices = []; // Cache das vozes dispon√≠veis (CORRE√á√ÉO 1)
        let ttsInitialized = false; // Novo: Vari√°vel de controle para inicializa√ß√£o do TTS
        
        // CHAVE √öNICA DO DEVOCIONAL.
        const DEVOTIONAL_KEY = 'galatas'; 
        
        // NOVO: VARI√ÅVEIS DE ESTADO DE ACESSIBILIDADE DE FONTE
        let currentFontSize = parseFloat(localStorage.getItem('fontSize')) || 1.0; 
        const FONT_STEP = 0.1; // Incremento de 10%
        const FONT_MAX = 1.4;  // Tamanho m√°ximo (140%)
        const FONT_MIN = 0.8;  // Tamanho m√≠nimo (80%)
        
        // --- DADOS MULTI-IDIOMA (Tradu√ß√µes) ---
        const translations = {
            'pt-BR': {
                mainTitle: "7 Dias: A Sufici√™ncia de Cristo (Livro de G√°latas)",
				subTitle: "Uma caminhada de gra√ßa, identidade e liberdade",
                dayTitle: "Dia",
                progressLabelPrefix: "Progresso: ",
                checkLabel: "Marcar como Conclu√≠do",
                navPrev: "‚Üê Anterior",
                navNext: "Pr√≥ximo ‚Üí",
                footerText: "Direitos Reservados 2024",
                themeLight: "üåô Modo Escuro", 
                themeDark: "‚òÄÔ∏è Modo Claro",
                listenStart: "üîä Ou√ßa Aqui", 
                listenStop: "üõë Parar Leitura",
                listenPause: "‚è∏Ô∏è Pausar √Åudio",
                listenResume: "‚ñ∂Ô∏è Continuar",
                noContentAlert: "Conte√∫do para leitura n√£o encontrado.",
                ttsLoading: "‚è≥ Carregando √Åudio...", 
                ttsUnsupported: "‚ùå √Åudio Indispon√≠vel", 
                versiculoChave: "Vers√≠culo Chave:", 
                resumoMeditacao: "Resumo/Medita√ß√£o:", 
                aplicacaoPratica: "Aplica√ß√£o Pr√°tica:", 
                oracaoLabel: "Ora√ß√£o:",
            },
            'en-US': {
                mainTitle: "7 Days: The Sufficiency of Christ (Book of Galatians)",
				subTitle: "A journey of grace, identity, and freedom.",
                dayTitle: "Day",
                progressLabelPrefix: "Progress: ",
                checkLabel: "Mark as Completed",
                navPrev: "‚Üê Previous",
                navNext: "Next ‚Üí",
                footerText: "All Rights Reserved 2024",
                themeLight: "üåô Dark Mode",
                themeDark: "‚òÄÔ∏è Light Mode",
                listenStart: "üîä Listen Here", 
                listenStop: "üõë Stop Reading",
                listenPause: "‚è∏Ô∏è Pause Audio",
                listenResume: "‚ñ∂Ô∏è Resume",
                noContentAlert: "Content for reading not found.",
                ttsLoading: "‚è≥ Loading Audio...", 
                ttsUnsupported: "‚ùå Audio Unavailable",
                versiculoChave: "Key Verse:", 
                resumoMeditacao: "Summary/Meditation:", 
                aplicacaoPratica: "Practical Application:", 
                oracaoLabel: "Prayer:",
            },
            'es-ES': {
                mainTitle: "7 D√≠as: La Suficiencia de Cristo (Libro de G√°latas)",
				subTitle: "Una caminata de gracia, identidad y libertad.",	
                dayTitle: "D√≠a",
                progressLabelPrefix: "Progreso: ",
                checkLabel: "Marcar como Concluido",
                navPrev: "‚Üê Anterior",
                navNext: "Siguiente ‚Üí",
                footerText: "Todos los derechos reservados 2024",
                themeLight: "üåô Modo Oscuro",
                themeDark: "‚òÄÔ∏è Modo Claro",
                listenStart: "üîä Escuchar Aqu√≠", 
                listenStop: "üõë Detener Lectura",
                listenPause: "‚è∏Ô∏è Pausar Audio",
                listenResume: "‚ñ∂Ô∏è Continuar",
                noContentAlert: "Contenido para escuchar no encontrado.",
                ttsLoading: "‚è≥ Cargando Audio...", 
                ttsUnsupported: "‚ùå Audio No Disponible",
                versiculoChave: "Vers√≠culo Clave:", 
                resumoMeditacao: "Resumen/Meditaci√≥n:", 
                aplicacaoPratica: "Aplicaci√≥n Pr√°ctica:", 
                oracaoLabel: "Oraci√≥n:",
            },
            'fr-FR': {
                mainTitle: "7 Jours : La Suffisance du Christ (Livre des Galates)",
				subTitle: "Un parcours de gr√¢ce, d‚Äôidentit√© et de libert√©.",
                dayTitle: "Jour",
                progressLabelPrefix: "Progression : ",
                checkLabel: "Marquer comme Accomplie",
                navPrev: "‚Üê Pr√©c√©dent",
                navNext: "Suivant ‚Üí",
                footerText: "Tous droits r√©serv√©s 2024",
                themeLight: "üåô Mode Sombre",
                themeDark: "‚òÄÔ∏è Mode Clair",
                listenStart: "üîä √âcoutez Ici", 
                listenStop: "üõë Arr√™ter Lecture",
                listenPause: "‚è∏Ô∏è Pause Audio", 
                listenResume: "‚ñ∂Ô∏è Reprendre",
                noContentAlert: "Contenu √† lire introuvable.",
                ttsLoading: "‚è≥ Chargement Audio...", 
                ttsUnsupported: "‚ùå Audio Indispon√≠vel",
                versiculoChave: "Verset Cl√©:", 
                resumoMeditacao: "R√©sum√©/M√©ditation:", 
                aplicacaoPratique: "Application Pratique:", 
                oracaoLabel: "Pri√®re:",
            }
        };

        // --- ELEMENTOS DOM ---
        const mainTitle = document.getElementById('mainTitle');
        const subTitle = document.getElementById('subTitle');
        const progressLabel = document.getElementById('progressLabel');
        const checkLabel = document.getElementById('checkLabel');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const completedCheck = document.getElementById('completedCheck');
        const devotionalContentDiv = document.getElementById('devotionalContent');
        const footerText = document.getElementById('footerText');
        const progressBar = document.getElementById('progressBar');

        // ELEMENTOS DOM TTS/TEMA
        const langSelectButton = document.getElementById('langSelectButton');
        const langDropdown = document.getElementById('langDropdown');
        const themeToggle = document.getElementById('themeToggle');
        const listenToggle = document.getElementById('listenToggle'); 
        const audioProgressContainer = document.getElementById('audioProgressContainer');
        const audioProgressBar = document.getElementById('audioProgressBar');


  // * FUN√á√ïES DE UTILIDADE *
    
        // üí• CORRE√á√ÉO AQUI: Implementa o avan√ßo para o pr√≥ximo dia se a caixa for marcada.
        function handleCompletedCheck() {
            const isCompleted = completedCheck.checked;
			saveCompletion(currentDay, isCompleted);
            
            // Verifica se o dia foi marcado como conclu√≠do E n√£o √© o √∫ltimo dia
            if (isCompleted && currentDay < totalDays) {
                nextDay(); 
            }
		}
        
        // --- NOVO: FUN√á√ïES DE CONTROLE DE FONTE ---
        function updateFontSize() {
            // Define a vari√°vel CSS na raiz do documento
            document.documentElement.style.setProperty('--base-font-scale', currentFontSize.toFixed(2));
            localStorage.setItem('fontSize', currentFontSize.toFixed(2));
        }

        function increaseFontSize() {
            if (currentFontSize < FONT_MAX) {
                currentFontSize = Math.min(FONT_MAX, currentFontSize + FONT_STEP);
                updateFontSize();
            }
        }

        function decreaseFontSize() {
            if (currentFontSize > FONT_MIN) {
                currentFontSize = Math.max(FONT_MIN, currentFontSize - FONT_STEP);
                updateFontSize();
            }
        }
        
        // --- FUN√á√ïES DE TEMA ---
        function applyTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('theme', theme);
            
            document.body.classList.remove('light-theme', 'dark-theme');
            document.body.classList.add(theme === 'dark' ? 'dark-theme' : 'light-theme');
        }

        function toggleDarkMode() {
            const newTheme = themeMap[currentTheme].next;
            applyTheme(newTheme);
            updateTexts(0);
        }

        function loadThemePreference() {
            applyTheme(SAVED_THEME);
        }
        
        // --- FUN√á√ïES DE IDIOMA (COM BANDEIRAS) ---
        function setLanguage(langCode) {
            currentLang = langCode;
            localStorage.setItem('language', langCode);
            
            // Parar a leitura ao trocar de idioma
            stopSpeaking(); 
            
            updateTexts(0);
            updateLanguageSelector();
            // Atualiza o estado visual para a nova l√≠ngua. 
            updateListenToggle('start'); 
        }

        function updateLanguageSelector() {
            if (!langSelectButton || !langDropdown) return;
            
            const currentFlag = flagMap[currentLang];
            // 1. Atualiza o bot√£o com a bandeira e nome do idioma ativo
            langSelectButton.innerHTML = currentFlag.iconActive + currentFlag.text;
            
            // 2. Limpa e reconstr√≥i o dropdown, excluindo o idioma ativo
            langDropdown.innerHTML = '';
            Object.keys(flagMap).forEach(lang => {
                if (lang !== currentLang) {
                    const flag = flagMap[lang];
                    const link = document.createElement('a');
                    link.innerHTML = flag.icon + flag.text; 
                    link.setAttribute('data-lang', lang);
                    link.setAttribute('href', '#'); 
                    
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        setLanguage(lang);
                        langDropdown.style.display = 'none';
                        // NOVO ARIA: fecha o dropdown, atualiza o status do bot√£o
                        langSelectButton.setAttribute('aria-expanded', 'false'); 
                    });
                    
                    langDropdown.appendChild(link);
                }
            });
        }

        // FUN√á√ÉO TTS: Fun√ß√µes de controle da barra de progresso do √°udio
        function resetAudioProgressBar(hide = false) {
            if (audioProgressBar) audioProgressBar.style.width = '0%';
            if (audioProgressContainer) {
                // Apenas esconde se for pedido, para n√£o piscar no in√≠cio
                audioProgressContainer.style.display = hide ? 'none' : 'block';
            }
        }
        
        // --- FUN√á√ÉO DE ATUALIZA√á√ÉO DE TEXTOS ---
        function updateTexts(direction = 1) { 
            const t = translations[currentLang] || translations['pt-BR']; 

            document.documentElement.lang = currentLang.split('-')[0];

            mainTitle.innerText = t.mainTitle;
            subTitle.innerText = t.subTitle;
            progressLabel.innerText = `${t.progressLabelPrefix}${t.dayTitle} ${currentDay} de ${totalDays}`;
            checkLabel.innerText = t.checkLabel;
            prevButton.innerText = t.navPrev;
            nextButton.innerText = t.navNext;
            footerText.innerText = t.footerText;
            
            if (currentTheme === 'light') {
                themeToggle.innerHTML = t.themeLight; 
            } else {
                themeToggle.innerHTML = t.themeDark; 
            }

            const contentLangKey = currentLang.substring(0, 2); 
            loadDevotionalContent(currentDay, contentLangKey, t);

            // üí• CORRE√á√ÉO: Chamando updateProgressState e updateOverallProgress em ordem
            updateProgressState();
            updateOverallProgress();

            if (window.speechSynthesis && window.speechSynthesis.speaking) {
                stopSpeaking(); 
            }
        }
        
        // --- FUN√á√ÉO DE CARREGAMENTO DE CONTE√öDO ---
        function loadDevotionalContent(day, contentLangKey, t) { 
            const data = devotionalContent[day] ? devotionalContent[day][contentLangKey] || devotionalContent[day]['pt'] : null;
            
            if (!data) {
                devotionalContentDiv.innerHTML = `<p style="text-align: center;">${t.noContentAlert || 'Conte√∫do n√£o dispon√≠vel para o Dia ${day} neste idioma.'}</p>`;
                return;
            }
            
            devotionalContentDiv.innerHTML = `
                <h2 id="dayTitle">${t.dayTitle} ${day}: ${data.h2}</h2>
                <div class="section">
                    <strong>${t.versiculoChave}</strong>
                    <p class="versiculos">${data.versiculos}</p>
                </div>
                <div class="section">
                    <strong>${t.resumoMeditacao}</strong>
                    <p>${data.resumo}</p>
                </div>
                <div class="section">
                    <strong>${t.aplicacaoPratica}</strong>
                    <p>${data.aplicacao}</p>
                </div>
                <p class="oracao-final">${t.oracaoLabel} ${data.oracao}</p>
            `;
            
            document.getElementById('pageCounter').innerText = `P√°gina ${day} de ${totalDays}`; 

            updateListenToggle('start'); 
        }
        
        // --- FUN√á√ïES DE NAVEGA√á√ÉO ---
        function nextDay() {
            stopSpeaking(); 
            if (currentDay < totalDays) {
                currentDay++;
                localStorage.setItem(`devotionalProgress_${DEVOTIONAL_KEY}`, currentDay);
                updateTexts(1);
            }
        }
        
        function prevDay() {
            stopSpeaking();
            if (currentDay > 1) {
                currentDay--;
                localStorage.setItem(`devotionalProgress_${DEVOTIONAL_KEY}`, currentDay);
                updateTexts(-1);
            }
        }

        // --- FUN√á√ïES DE LEITURA (TEXT-TO-SPEECH) ---
        
        function getVoiceForLanguage(langCode) {
            const desiredLang = langCode.toLowerCase();
            
            if (ttsVoices.length === 0) {
                console.warn('TTS: Vozes n√£o carregadas.');
                return null;
            }
            
            let voice = ttsVoices.find(v => v.lang.toLowerCase() === desiredLang && v.localService);
            if (!voice) {
                voice = ttsVoices.find(v => v.lang.toLowerCase() === desiredLang);
            }
            if (!voice) {
                const langPrefix = desiredLang.substring(0, 2);
                voice = ttsVoices.find(v => v.lang.toLowerCase().startsWith(langPrefix));
            }

            return voice || ttsVoices[0];
        }

        function speakContent() {
            const t = translations[currentLang] || translations['pt-BR']; 
            const contentElement = document.getElementById('devotionalContent');
            
            if (!synth || synth.speaking) {
                return;
            }

            const textToSpeak = contentElement.innerText || contentElement.textContent;

            if (!textToSpeak) {
                alert(t.noContentAlert || "Conte√∫do para leitura n√£o encontrado.");
                return;
            }

            totalChars = textToSpeak.length;

            resetAudioProgressBar();
            
            utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = currentLang;

            const voice = getVoiceForLanguage(currentLang);
            if (voice) {
                utterance.voice = voice;
            } else {
                 alert(t.ttsUnsupported + " " + t.noContentAlert);
                 stopSpeaking();
                 return;
            }


            utterance.onboundary = (event) => {
                const progress = (event.charIndex / totalChars) * 100;
                if (audioProgressBar) audioProgressBar.style.width = `${progress}%`;
            };

            utterance.onend = () => {
                resetAudioProgressBar(true);
                updateListenToggle('start');
            };

            synth.speak(utterance);
            updateListenToggle('speaking');
        }

        function stopSpeaking() {
            if (synth && synth.speaking) {
                synth.cancel();
            }
            if (synth) {
                 synth.cancel();
            }
            resetAudioProgressBar(true);
            updateListenToggle('start');
        }

        function handleListenClick() {
            if (!synth || listenToggle.disabled) return;
            
            if (synth.speaking && !synth.paused) {
                // Pausar
                synth.pause();
                updateListenToggle('paused');
            } else if (synth.paused) {
                // Continuar
                synth.resume();
                updateListenToggle('speaking');
            } else if (!synth.speaking) {
                // Iniciar a leitura
                speakContent();
            }
        }

        function initTTS() {
            if (ttsInitialized) return;

            const t = translations[currentLang] || translations['pt-BR']; 
            
            if (!synth) {
                listenToggle.innerHTML = t.ttsUnsupported;
                listenToggle.disabled = true;
                return;
            }

            synth.onvoiceschanged = () => {
                ttsVoices = synth.getVoices();
                if (ttsVoices.length > 0) {
                    listenToggle.disabled = false;
                    updateListenToggle('start');
                    ttsInitialized = true;
                } else {
                    listenToggle.innerHTML = t.ttsUnsupported;
                    listenToggle.disabled = true;
                }
            };
            
            ttsVoices = synth.getVoices();
            if (ttsVoices.length > 0) {
                listenToggle.disabled = false;
                updateListenToggle('start');
                ttsInitialized = true;
                synth.onvoiceschanged = null;
            } else {
                listenToggle.innerHTML = t.ttsLoading;
                listenToggle.disabled = true;
            }
        }

        function updateListenToggle(state = 'start') {
             const t = translations[currentLang] || translations['pt-BR']; 
             const button = listenToggle;
             if (!button) return;

             // Resetar estilos customizados (para o dark theme funcionar)
             button.style.cssText = ''; 

             if (state === 'speaking') {
                 button.innerHTML = t.listenPause || '‚è∏Ô∏è Pausar √Åudio';
                 button.title = 'Pausar a leitura';
                 button.style.backgroundColor = '#ffc107';
                 button.style.color = '#333';
             } else if (state === 'paused') {
                 button.innerHTML = t.listenResume || '‚ñ∂Ô∏è Continuar';
                 button.title = 'Continuar a leitura';
                 button.style.backgroundColor = '#28a745';
                 button.style.color = 'white';
             } else { 
                 // state === 'start' (Ocioso/Parado)
                 button.innerHTML = t.listenStart || 'üîä Ou√ßa Aqui';
                 button.title = 'Iniciar a leitura do devocional';
             }
        }

        // --- CONTE√öDO DEVOCIONAL (MANTIDO) ---
        const devotionalContent = { 1: {pt: {h2: "O √önico Evangelho Verdadeiro (Sola Gratia)", versiculos: "G√°latas 1:8-9 (NVI): Mas, ainda que n√≥s ou um anjo do c√©u pregue um evangelho diferente daquele que lhes pregamos, que seja an√°tema.", resumo: "G√°latas come√ßa com a defesa de que existe apenas um Evangelho, que √© a justifica√ß√£o pela f√© em Cristo, separada das obras da Lei (legalismo). Qualquer adi√ß√£o (como circuncis√£o ou observ√¢ncia ritual) que busque o m√©rito humano anula a gra√ßa de Cristo. Esta √© a doutrina da Gra√ßa Exclusiva (Sola Gratia): ou √© totalmente a Gra√ßa, ou n√£o √© Gra√ßa de forma alguma.", aplicacao: "Em quais √°reas voc√™ tem adicionado 'esfor√ßo humano' ou rituais √† obra completa de Cristo, buscando valida√ß√£o ou 'n√≠veis' mais altos de aceita√ß√£o por Deus? Descanse na sufici√™ncia de Cristo (Solus Christus).", oracao: "Ore a Deus agradecendo pela pureza do Evangelho. Pe√ßa ao Senhor que o livre de qualquer forma de legalismo ou autojustifica√ß√£o, renovando sua f√© na obra completa de Jesus."} , en: {h2: "The Only True Gospel (Sola Gratia)", versiculos: "Galatians 1:8-9 (NIV): But even if we or an angel from heaven should preach a gospel other than the one we preached to you, let them be under God's curse!", resumo: "Galatians begins with the defense that there is only one Gospel, which is justification by faith in Christ, separate from the works of the Law (legalism). Any addition (like circumcision or ritual observance) that seeks human merit nullifies the grace of Christ. This is the doctrine of Exclusive Grace (Sola Gratia): it is either entirely Grace, or it is no Grace at all.", aplicacao: "In what areas have you added 'human effort' or rituals to the complete work of Christ, seeking validation or 'higher levels' of acceptance by God? Rest in the sufficiency of Christ (Solus Christus).", oracao: "Pray to God, thanking Him for the purity of the Gospel. Ask the Lord to free you from any form of legalism or self-righteousness, renewing your faith in the completed work of Jesus."}, es: {h2: "The Only True Gospel (Sola Gratia)", versiculos: "Galatians 1:8-9 (NVI): Pero aun si nosotros o un √°ngel del cielo les predicara un evangelio diferente del que les hemos predicado, ¬°que caiga sobre √©l la maldici√≥n!", resumo: "G√°latas comienza con la defensa de que existe solo un Evangelio, que es la justificaci√≥n por la fe en Cristo, separada de las obras de la Ley (legalismo). Cualquier adici√≥n (como la circuncisi√≥n o la observancia ritual) que busque el m√©rito humano anula la gracia de Cristo. Esta es la doctrina de la Gracia Exclusiva (Sola Gratia): o es totalmente la Gracia, o no es Gracia en absoluto.", aplicacao: "¬øEn qu√© √°reas has a√±adido 'esfuerzo humano' o rituales a la obra completa de Cristo, buscando validaci√≥n o 'niveles' m√°s altos de aceptaci√≥n ante Dios? Descansa en la suficiencia de Cristo (Solus Christus).", oracao: "Ora a Dios agradeciendo por la pureza del Evangelio. Pide al Se√±or que te libere de cualquier forma de legalismo o autojustificaci√≥n, renovando tu fe en la obra completa de Jes√∫s."}, fr: {h2: "Le Seul V√©ritable √âvangile (Sola Gratia)", versiculos: "Galates 1:8-9 (Louis Segond): Mais, quand nous-m√™mes, quand un ange du ciel annoncerait un √âvangile diff√©rent de celui que nous vous avons annonc√©, qu'il soit anath√®me!", resumo: "Galates commence par la d√©fense qu'il n'existe qu'un seul √âvangile, qui est la justification par la foi en Christ, s√©par√©e des ≈ìuvres de la Loi (l√©galisme). Toute addition (comme la circision ou l'observance rituelle) qui cherche le m√©rite humain annule la gr√¢ce du Christ. C'est la doctrine de la Gra√ßa Exclusiva (Sola Gratia): soit c'est enti√®rement la Gr√¢ce, soit ce n'est pas la Gr√¢ce du tout.", aplicacao: "Dans quels domaines avez-vous ajout√© des 'efforts humains' ou des rituels √† l'≈ìuvre compl√®te du Christ, cherchant validation ou des 'niveaux' sup√©rieurs d'acceptation par Dieu? Reposez-vous dans la suffisance du Christ (Solus Christus).", oracao: "Priez Dieu le remerciant pour la puret√© de l'√âvangile. Demandez au Seigneur de vous lib√©rer de toute forme de l√©galisme ou d'auto-justification, renouvelant votre foi dans l'≈ìuvre achev√©e de J√©sus."}}, 2: {pt: {h2: "Crucificado e Vivendo Pela F√©", versiculos: "G√°latas 2:20 (NVI): Fui crucificado com Cristo. Assim, j√° n√£o sou eu quem vive, mas Cristo vive em mim. A vida que agora vivo no corpo, vivo-a pela f√© no Filho de Deus, que me amou e se entregou por mim.", resumo: "Esta √© a ess√™ncia da Identidade em Cristo. Pela f√© (Sola Fide), fomos unidos a Ele em Sua morte e ressurrei√ß√£o (Uni√£o com Cristo). Isso significa que nossa velha identidade (escrava do pecado e da Lei) morreu, e a nova vida que possu√≠mos √© a pr√≥pria vida de Cristo manifestada em n√≥s. Nossa vida n√£o √© mais sobre nossos esfor√ßos, mas sobre a f√© cont√≠nua Nele.", aplicacao: "O que sua vida revela hoje: o 'velho eu' tentando se justificar ou a 'nova vida' confiando na sufici√™ncia de Cristo? Proclame essa verdade sobre si mesmo: 'J√° n√£o sou eu quem vive.'", oracao: "Ore a Deus pedindo que a verdade da sua crucifica√ß√£o e ressurrei√ß√£o com Cristo se torne a base de todas as suas decis√µes e a fonte do seu poder para a santifica√ß√£o."}, en: {h2: "Crucified and Living By Faith", versiculos: "Galatians 2:20 (NIV): I have been crucified with Christ and I no longer live, but Christ lives in me. The life I now live in the body, I live by faith in the Son of God, who loved me and gave himself for me.", resumo: "This is the essence of Identity in Christ. By faith (Sola Fide), we have been united with Him in His death and resurrection (Union with Christ). This means that our old identity (slave to sin and the Law) has died, and the new life we possess is Christ's very life manifested in us. Our life is no longer about our efforts but about continuous faith in Him.", aplicacao: "What does your life reveal today: the 'old self' trying to justify itself or the 'new life' trusting in Christ's sufficiency? Proclaim this truth over yourself: 'I no longer live.'", oracao: "Pray to God asking that the truth of your crucifixion and resurrection with Christ becomes the basis of all your decisions and the source of your power for sanctification."}, es: {h2: "Crucified and Living By Faith", versiculos: "Galatians 2:20 (NVI): Con Cristo he sido crucificado, y ya no soy yo quien vive, sino que es Cristo quien vive en m√≠. Y la vida que ahora vivo en el cuerpo, la vivo por la fe en el Hijo de Dios, quien me am√≥ y dio su vida por m√≠.", resumo: "Esta es la esencia de la Identidad en Cristo. Por la fe (Sola Fide), hemos sido unidos a √âl en Su muerte y resurrecci√≥n (Uni√≥n con Cristo). Esto significa que nuestra antigua identidad (esclava del pecado y de la Ley) muri√≥, y la nueva vida que poseemos es la propia vida de Cristo manifestada en nosotros. Nuestra vida ya no se trata de nuestros esfuerzos, sino de la fe continua en √âl.", aplicacao: "¬øQu√© revela tu vida hoy: el 'viejo yo' tratando de justificarse o la 'nueva vida' confiando en la suficiencia de Cristo? Proclama esta verdad sobre ti mismo: 'Ya no soy yo quien vive'.", oracao: "Ora a Dios pidiendo que la verdad de tu crucifixi√≥n y resurrecci√≥n con Cristo se convierta en el fundamento de todas tus decisiones y la fuente de tu poder para la santificaci√≥n."}, fr: {h2: "Crucifi√© et Vivant Par la Foi", versiculos: "Galates 2:20 (Louis Segond): J'ai √©t√© crucifi√© avec Christ; et si je vis, ce n'est plus moi qui vis, c'est Christ qui vit en moi; si je vis maintenant dans la chair, je vis dans la foi au Fils de Dieu, qui m'a aim√© et qui s'est livr√© lui-m√™me pour moi.", resumo: "Ceci est l'essence de l'Identit√© en Christ. Par la foi (Sola Fide), nous avons √©t√© unis √† Lui dans Sa mort et Sa r√©surrection (Union avec Christ). Cela signifie que notre ancienne identit√© (esclave du p√©ch√© et de la Loi) est morte, et la nouvelle vie que nous poss√©dons est la vie m√™me du Christ manifest√©e en nous. Notre vie ne concerne plus nos efforts, mais la foi continue en Lui.", aplicacao: "Que r√©v√®le votre vie aujourd'hui: le 'vieil homme' essayant de se justifier ou la 'nouvelle vie' faisant confiance √† la suffisance du Christ? Proclamez cette v√©rit√© sur vous-m√™me: 'Ce n'est plus moi qui vis.'", oracao: "Priez Dieu demandant que la v√©rit√© de votre crucifixion et r√©surrection avec Christ devienne la base de toutes vos d√©cisions et la source de votre puissance pour la sanctification."}}, 3: {pt: {h2: "Maldi√ß√£o da Lei vs. Promessa da F√©", versiculos: "G√°latas 3:13-14 (NVI): Cristo nos resgatou da maldi√ß√£o da Lei, fazendo-se maldi√ß√£o por n√≥s... para que em Cristo Jesus a b√™n√ß√£o de Abra√£o chegasse tamb√©m aos gentios, e para que receb√™ssemos a promessa do Esp√≠rito mediante a f√©.", resumo: "A Lei revela o pecado e a nossa incapacidade de agradar a Deus, resultando em maldi√ß√£o para quem n√£o a cumpre perfeitamente. A f√© (Sola Fide) √© o √∫nico caminho para receber a b√™n√ß√£o de Abra√£o (justifica√ß√£o e o Esp√≠rito Santo). Cristo tornou-se a maldi√ß√£o em nosso lugar, cumprindo perfeitamente a Lei e nos libertando de sua condena√ß√£o.", aplicacao: "Voc√™ sente o peso de 'ter que fazer' ou o al√≠vio de 'j√° ter sido feito'? Identifique onde voc√™ tem tentado ganhar a aceita√ß√£o de Deus por m√©rito, e descanse na obra de Cristo.", oracao: "Ore agradecendo a Cristo por se tornar maldi√ß√£o por voc√™. Pe√ßa ao Esp√≠rito Santo que o guie a viver pela f√© Nele, confiando unicamente na Sua justi√ßa."}, en: {h2: "Curse of the Law vs. Promise of Faith", versiculos: "Galatians 3:13-14 (NIV): Christ redeemed us from the curse of the law by becoming a curse for us... He redeemed us in order that the blessing given to Abraham might come to the Gentiles through Christ Jesus, so that by faith we might receive the promise of the Spirit.", resumo: "The Law reveals sin and our inability to please God, resulting in a curse for anyone who does not perfectly fulfill it. Faith (Sola Fide) is the only way to receive the blessing of Abraham (justification and the Holy Spirit). Christ became the curse in our place, perfectly fulfilling the Law and freeing us from its condemnation.", aplicacao: "Do you feel the burden of 'having to do' or the relief of 'it has already been done'? Identify where you have tried to earn God's acceptance by merit, and rest in the work of Christ.", oracao: "Pray thanking Christ for becoming a curse for you. Ask the Holy Spirit to guide you to live by faith in Him, trusting solely in His righteousness."}, es: {h2: "Maldici√≥n de la Ley vs. Promesa de la Fe", versiculos: "G√°latas 3:13-14 (NVI): Cristo nos rescat√≥ de la maldici√≥n de la ley al hacerse maldici√≥n por nosotros... para que en Cristo Jes√∫s la bendici√≥n de Abrah√°n llegara a los gentiles, a fin de que por la fe recibi√©ramos la promesa del Esp√≠ritu.", resumo: "La Ley revela el pecado y nuestra incapacidad para agradar a Dios, resultando en maldici√≥n para quien no la cumple perfectamente. La fe (Sola Fide) es el √∫nico camino para recibir la bendici√≥n de Abrah√°n (justificaci√≥n y el Esp√≠ritu Santo). Cristo se hizo maldici√≥n en nuestro lugar, cumpliendo perfectamente la Ley y liber√°ndonos de su condenaci√≥n.", aplicacao: "¬øSientes el peso de 'tener que hacer' o el alivio de 'ya ha sido hecho'? Identifica d√≥nde has intentado ganar la aceptaci√≥n de Dios por m√©rito, y descansa en la obra de Cristo.", oracao: "Ora agradeciendo a Cristo por hacerse maldici√≥n por ti. Pide al Esp√≠ritu Santo que te gu√≠e a vivir por la fe en √âl, confiando √∫nicamente en Su justicia."}, fr: {h2: "Mal√©diction de la Loi vs. Promesse de la Foi", versiculos: "Galates 3:13-14 (Louis Segond): Christ nous a rachet√©s de la mal√©diction de la loi, √©tant devenu mal√©diction pour nous... afin que la b√©n√©diction d'Abraham e√ªt pour les pa√Øens son accomplissement en J√©sus Christ, et que nous re√ßussions par la foi l'Esprit qui avait √©t√© promis.", resumo: "La Loi r√©v√®le le p√©ch√© et notre incapacit√© √† plaire √† Dieu, entra√Ænant une mal√©diction pour quiconque ne la remplit pas parfaitement. La foi (Sola Fide) est le seul chemin pour recevoir la b√©n√©diction d'Abraham (justification et le Saint-Esprit). Christ est devenu la mal√©diction √† notre place, remplissant parfaitement la Loi et nous lib√©rant de sa condamnation.", aplicacao: "Ressentez-vous le fardeau de 'devoir faire' ou le soulagement de 'cela a d√©j√† √©t√© fait'? Identifiez o√π vous avez tent√© de gagner l'acceptation de Dieu par le m√©rite, et reposez-vous dans l'≈ìuvre du Christ.", oracao: "Priez en remerciant Christ d'√™tre devenu mal√©diction pour vous. Demandez √† l'Esprit Saint de vous guider √† vivre par la foi en Lui, faisant uniquement confiance √† Sa justice."}}, 4: {pt: {h2: "De Escravos a Filhos e Herdeiros", versiculos: "G√°latas 4:6-7 (NVI): Visto que voc√™s s√£o filhos, Deus enviou o Esp√≠rito de seu Filho ao cora√ß√£o de voc√™s, o qual clama: ‚ÄúAba, Pai‚Äù. Assim, voc√™ j√° n√£o √© mais escravo, mas filho; e, por ser filho, Deus tamb√©m o tornou herdeiro.", resumo: "Pela f√© (Sola Fide), recebemos o Esp√≠rito Santo, que nos d√° a plena ado√ß√£o (Solus Christus). Nossa identidade muda de escravo (sob a Lei) para filhos adultos e herdeiros. Nossa filia√ß√£o n√£o se baseia em desempenho, mas na obra de Cristo e na habita√ß√£o do Esp√≠rito, que nos d√° a confian√ßa de clamar 'Aba, Pai'.", aplicacao: "Voc√™ vive com a mentalidade de escravo (medo de puni√ß√£o) ou de filho (seguran√ßa em seu Pai)? Aceite a plena heran√ßa que √© sua em Cristo.", oracao: "Ore agradecendo a Deus pela sua ado√ß√£o. Pe√ßa ao Esp√≠rito Santo que aprofunde sua convic√ß√£o de que voc√™ √© um filho amado e herdeiro, e n√£o mais um escravo."}, en: {h2: "From Slaves to Sons and Heirs", versiculos: "Galatians 4:6-7 (NIV): Because you are his sons, God sent the Spirit of his Son into our hearts, the Spirit who calls out, 'Abba, Father.' So you are no longer a slave, but God's child; and since you are his child, God has made you also an heir.", resumo: "By faith (Sola Fide), we receive the Holy Spirit, who gives us full adoption (Solus Christus). Our identity changes from a slave (under the Law) to an adult son and heir. Our sonship is not based on performance but on Christ's work and the indwelling of the Spirit, which gives us the confidence to cry out 'Abba, Father.'", aplicacao: "Do you live with the mindset of a slave (fear of punishment) or a son (security in your Father)? Accept the full inheritance that is yours in Christ.", oracao: "Pray thanking God for your adoption. Ask the Holy Spirit to deepen your conviction that you are a beloved child and heir, and no longer a slave."}, es: {h2: "De Esclavos a Hijos y Herederos", versiculos: "G√°latas 4:6-7 (NVI): Y puesto que ya son hijos, Dios envi√≥ a nuestros corazones el Esp√≠ritu de su Hijo, que clama: ‚Äú¬°Abba! ¬°Padre!‚Äù. As√≠ que ya no eres esclavo, sino hijo; y como eres hijo, Dios te ha hecho tambi√©n heredero.", resumo: "Por la fe (Sola Fide), recibimos el Esp√≠ritu Santo, que nos da la adopci√≥n plena (Solus Christus). Nuestra identidad cambia de esclavo (bajo la Ley) a hijos adultos y herederos. Nuestra filiaci√≥n no se basa en el rendimiento, sino en la obra de Cristo y en la morada del Esp√≠ritu, que nos da la confianza de clamar '¬°Abba, Padre!'.", aplicacao: "¬øVives con la mentalidad de esclavo (miedo al castigo) o de hijo (seguridad en tu Padre)? Acepta la herencia completa que es tuya en Cristo.", oracao: "Ora a Dios pidiendo que la verdad de tu crucifixi√≥n y resurrecci√≥n con Cristo se convierta en el fundamento de todas tus decisiones y la fuente de tu poder para la santificaci√≥n."}, fr: {h2: "D'Esclaves √† Fils et H√©ritiers", versiculos: "Galates 4:6-7 (Louis Segond): Et parce que vous √™tes fils, Dieu a envoy√© dans nos c≈ìurs l'Esprit de son Fils, lequel crie: Abba! P√®re! Ainsi tu n'es plus esclave, mais fils; et si tu es fils, tu es aussi h√©ritier par la gr√¢ce de Dieu.", resumo: "Par la foi (Sola Fide), nous avons √©t√© unis √† Lui dans Sa mort et Sa r√©surrection (Union avec Christ). Cela signifie que notre ancienne identit√© (esclave du p√©ch√© et de la Loi) est morte, et la nouvelle vie que nous poss√©dons est la vie m√™me du Christ manifest√©e en nous. Notre vie ne concerne plus nos efforts, mais la foi continue en Lui.", aplicacao: "Vivez-vous avec la mentalit√© d'esclave (peur de la punition) ou de fils (s√©curit√© en votre P√®re)? Acceptez le plein h√©ritage qui est le v√¥tre en Christ.", oracao: "Priez en remerciant Dieu pour votre adoption. Demandez √† l'Esprit Saint d'approfondir votre conviction que vous √™tes un enfant bien-aim√© et h√©ritier, et non plus un esclave."}}, 5: {pt: {h2: "Libertados para a Liberdade", versiculos: "G√°latas 5:1 (NVI): Foi para a liberdade que Cristo nos libertou. Portanto, permane√ßam firmes e n√£o se deixem submeter novamente a um jugo de escravid√£o.", resumo: "A verdadeira liberdade n√£o est√° na licen√ßa para pecar, nem na escravid√£o √† Lei. Ela est√° na uni√£o com Cristo, que nos liberta da condena√ß√£o da Lei e do poder do pecado. A vida crist√£ n√£o √© uma corrida para ganhar aceita√ß√£o, mas a manuten√ß√£o da posi√ß√£o de liberdade j√° conquistada por Cristo (Solus Christus).", aplicacao: "O que o tem prendido ultimamente: a culpa por falhas passadas ou o medo de n√£o ser 'santo o suficiente'? Reafirme sua liberdade em Cristo, que √© total e suficiente.", oracao: "Ore a Deus pedindo for√ßa para permanecer firme na liberdade. Pe√ßa que Ele o livre de qualquer jugo de escravid√£o ou sentimento de culpa, capacitando-o a viver de acordo com a sua nova identidade."}, en: {h2: "Freed for Freedom", versiculos: "Galatians 5:1 (NIV): It is for freedom that Christ has set us free. Stand firm, then, and do not let yourselves be burdened again by a yoke of slavery.", resumo: "True freedom is not found in a license to sin, nor in slavery to the Law. It is found in union with Christ, which frees us from the condemnation of the Law and the power of sin. The Christian life is not a race to gain acceptance, but the maintenance of the position of freedom already won by Christ (Solus Christus).", aplicacao: "What has been holding you back lately: guilt over past failures or the fear of not being 'holy enough'? Reaffirm your freedom in Christ, which is complete and sufficient.", oracao: "Pray to God for strength to stand firm in freedom. Ask Him to free you from any yoke of slavery or feeling of guilt, empowering you to live according to your new identity."}, es: {h2: "Liberados para la Libertad", versiculos: "G√°latas 5:1 (NVI): Cristo nos libert√≥ para que vivamos en libertad. Por lo tanto, mant√©nganse firmes y no se sometan nuevamente al yugo de la esclavitud.", resumo: "La verdadera libertad no se encuentra en la licencia para pecar, ni en la esclavitud a la Ley. Se encuentra en la uni√≥n con Cristo, que nos libera de la condenaci√≥n de la Ley y del poder del pecado. La vida cristiana no es una carrera para ganar aceptaci√≥n, sino el mantenimiento de la posici√≥n de libertad ya conquistada por Cristo (Solus Christus).", aplicacao: "¬øQu√© te ha estado reteniendo √∫ltimamente: la culpa por fallas pasadas o el miedo a no ser lo 'suficientemente santo'? Reafirma tu libertad en Cristo, que es total y suficiente.", oracao: "Ora a Dios pidiendo fuerza para mantenerte firme en la libertad. Pide que √âl te libere de cualquier yugo de esclavitud o sentimiento de culpa, capacit√°ndote para vivir de acuerdo con tu nueva identidad."}, fr: {h2: "Lib√©r√©s pour la Libert√©", versiculos: "Galates 5:1 (Louis Segond): C'est pour la libert√© que Christ nous a affranchis. Demeurez donc fermes, et ne vous laissez pas mettre de nouveau sous le joug de la servitude.", resumo: "La v√©ritable libert√© ne se trouve ni dans la licence de p√©cher, ni dans l'esclavage √† la Loi. Elle se trouve dans l'union avec Christ, qui nous lib√®re de la condamnation de la Loi et du pouvoir du p√©ch√©. La vie chr√©tienne n'est pas une course pour gagner l'acceptation, mais le maintien de la position de libert√© d√©j√† acquise par Christ (Solus Christus).", aplicacao: "Ressentez-vous le fardeau de 'devoir faire' ou le soulagement de 'cela a d√©j√† √©t√© fait'? Identifiez o√π vous avez tent√© de gagner l'acceptation de Dieu par le m√©rite, et reposez-vous dans l'≈ìuvre du Christ.", oracao: "Priez en remerciant Christ d'√™tre devenu mal√©diction pour vous. Demandez √† l'Esprit Saint de vous guider √† vivre par la foi en Lui, vous donnant les moyens de vivre selon votre nouvelle identit√©."}}, 6: {pt: {h2: "Fruto do Esp√≠rito vs. Obras da Carne", versiculos: "G√°latas 5:22-23 (NVI): Mas o fruto do Esp√≠rito √© amor, alegria, paz, paci√™ncia, amabilidade, bondade, fidelidade, mansid√£o e dom√≠nio pr√≥prio. Contra essas coisas n√£o h√° Lei.", resumo: "O Esp√≠rito Santo (Solo Spiritus) √© quem nos capacita a viver uma vida que agrada a Deus. Em vez de tentarmos cumprir a Lei pelo esfor√ßo da carne, devemos andar no Esp√≠rito. O fruto √© uma evid√™ncia interna e espont√¢nea de que n√£o estamos mais vivendo sob o poder da carne e da condena√ß√£o legalista.", aplicacao: "Quais frutos t√™m sido mais evidentes em sua vida? Entregue sua vontade ao Esp√≠rito Santo e pe√ßa que Ele produza Seu fruto em voc√™.", oracao: "Ore ao Esp√≠rito Santo, pedindo para ser cheio e guiado por Ele. Pe√ßa que Ele produza em voc√™ o fruto que manifesta a vida de Cristo, especialmente onde voc√™ tem lutado contra as obras da carne."}, en: {h2: "Fruit of the Spirit vs. Works of the Flesh", versiculos: "Galatians 5:22-23 (NIV): But the fruit of the Spirit is love, joy, peace, forbearance, kindness, goodness, faithfulness, gentleness and self-control. Against such things there is no law.", resumo: "The Holy Spirit (Solo Spiritus) is the one who enables us to live a life that pleases God. Instead of trying to keep the Law by the effort of the flesh, we must walk in the Spirit. The fruit is an internal and spontaneous evidence that we are no longer living under the power of the flesh and legalistic condemnation.", aplicacao: "Which fruits have been most evident in your life? Surrender your will to the Holy Spirit and ask Him to produce His fruit in you.", oracao: "Pray to the Holy Spirit, asking to be filled and guided by Him. Ask Him to produce in you the fruit that manifests the life of Christ, especially where you have been struggling against the works of the flesh."}, es: {h2: "Fruto del Esp√≠ritu vs. Obras de la Carne", versiculos: "G√°latas 5:22-23 (NVI): En cambio, el fruto del Esp√≠ritu es amor, alegr√≠a, paz, paciencia, amabilidad, bondad, fidelidad, mansedumbre y dominio propio. No hay ley que condene estas cosas.", resumo: "El Esp√≠ritu Santo (Solo Spiritus) es quien nos capacita para vivir una vida que agrada a Dios. En lugar de intentar cumplir la Ley por el esfuerzo de la carne, debemos andar en el Esp√≠ritu. El fruto es una evidencia interna y espont√°nea de que ya no estamos viviendo bajo el poder de la carne y la condenaci√≥n legalista.", aplicacao: "¬øQu√© frutos han sido m√°s evidentes en tu vida? Entrega tu voluntad al Esp√≠ritu Santo y p√≠dele que √âl produzca Su fruto en ti.", oracao: "Ora al Esp√≠ritu Santo, pidiendo ser lleno y guiado por √âl. P√≠dele que produzca en ti el fruto que manifiesta la vida de Cristo, especialmente donde has estado luchando contra las obras de la carne."}, fr: {h2: "Fruit de l'Esprit vs. ≈íuvres de la Chair", versiculos: "Galates 5:22-23 (Louis Segond): Mais le fruit de l'Esprit est l'amour, la joie, la paix, la patience, la bont√©, la b√©nignit√©, la fid√©lit√©, la douceur, la temp√©rance; la loi n'est point contre ces choses.", resumo: "L'Esprit Saint (Solo Spiritus) est celui qui nous permet de vivre une vie qui pla√Æt √† Dieu. Au lieu d'essayer de garder la Loi par l'effort de la chair, nous devons marcher par l'Esprit. Le fruit est une preuve interne et spontan√©e que nous ne vivons plus sous la puissance de la chair et de la condamnation l√©galiste.", aplicacao: "Quels fruits ont √©t√© les plus √©vidents dans votre vie? Abandonnez votre volont√© √† l'Esprit Saint et demandez-Lui de produire Son fruit en vous.", oracao: "Priez l'Esprit Saint, demandant d'√™tre rempli et guid√© par Lui. Demandez-Lui de produire en vous le fruit qui manifeste la vie du Christ, surtout l√† o√π vous avez lutt√© contre les ≈ìuvres de la chair."}}, 7: {pt: {h2: "Semear no Esp√≠rito e Colher a Vida Eterna", versiculos: "G√°latas 6:7-9 (NVI): N√£o se deixem enganar: de Deus n√£o se zomba. Pois o que o homem semear, isso tamb√©m colher√°. Quem semeia para a sua carne, da carne colher√° destrui√ß√£o; mas quem semeia para o Esp√≠rito, do Esp√≠rito colher√° a vida eterna. N√£o nos cansemos de fazer o bem, pois a seu tempo colheremos, se n√£o desanimarmos.", resumo: "O encerramento de G√°latas nos lembra da Soberania de Deus (Soli Deo Gloria) e do princ√≠pio da semeadura e colheita. A vida em Cristo, justificada pela f√©, √© sustentada pelo Esp√≠rito. Nossas a√ß√µes (carne vs. Esp√≠rito) t√™m consequ√™ncias espirituais. N√£o √© para ganhar a salva√ß√£o, mas para manifestar a salva√ß√£o j√° recebida, vivendo em amor e cuidado m√∫tuo.", aplicacao: "O que voc√™ tem 'semeado' mais em sua vida hoje: tempo em coisas da carne (preocupa√ß√µes, medos, v√≠cios) ou tempo em coisas do Esp√≠rito (ora√ß√£o, Palavra, servi√ßo)? Continue fazendo o bem, pois a recompensa √© certa em Cristo.", oracao: "Ore a Deus pedindo discernimento para semear no Esp√≠rito. Pe√ßa que Ele renove suas for√ßas para n√£o se cansar de fazer o bem, vivendo para a Sua gl√≥ria."}, en: {h2: "Sowing in the Spirit and Reaping Eternal Life", versiculos: "Galatians 6:7-9 (NIV): Do not be deceived: God cannot be mocked. A man reaps what he sows. Whoever sows to please their flesh, from the flesh will reap destruction; whoever sows to please the Spirit, from the Spirit will reap eternal life. Let us not become weary in doing good, for at the proper time we will reap a harvest if we do not give up.", resumo: "The conclusion of Galatians reminds us of God's Sovereignty (Soli Deo Gloria) and the principle of sowing and reaping. The life in Christ, justified by faith, is sustained by the Spirit. Our actions (flesh vs. Spirit) have spiritual consequences. It is not to earn salvation, but to manifest the salvation already received, living in love and mutual care.", aplicacao: "What have you been 'sowing' more in your life today: time into the things of the flesh (worries, fears, vices) or time into the things of the Spirit (prayer, Word, service)? Continue doing good, for the reward is certain in Christ.", oracao: "Pray to God for discernment to sow in the Spirit. Ask Him to renew your strength not to grow weary in doing good, living for His glory."}, es: {h2: "Sembrar en el Esp√≠ritu y Cosechar la Vida Eterna", versiculos: "G√°latas 6:7-9 (NVI): No se enga√±en: de Dios nadie se burla. Todo lo que el hombre siembre, eso tambi√©n cosechar√°. El que siembra para agradar a su naturaleza pecaminosa, de esa misma naturaleza cosechar√° destrucci√≥n; el que siembra para agradar al Esp√≠ritu, del Esp√≠ritu cosechar√° vida eterna. No nos cansemos de hacer el bien, porque a su debido tiempo cosecharemos si no nos damos por vencidos.", resumo: "El cierre de G√°latas nos recuerda la Soberan√≠a de Dios (Soli Deo Gloria) y el principio de la siembra y la cosecha. La vida en Cristo, justificada por la fe, es sostenida por el Esp√≠ritu. Nuestras acciones (carne vs. Esp√≠ritu) tienen consecuencias espirituales. No es para ganar la salvaci√≥n, sino para manifestar la salvaci√≥n ya recibida, viviendo en amor y cuidado mutuo.", aplicacao: "¬øQu√© has estado 'sembrando' m√°s en tu vida hoy: tiempo en las cosas de la carne (preocupaciones, miedos, vicios) o tiempo en las cosas del Esp√≠ritu (oraci√≥n, Palabra, servicio)? Contin√∫a haciendo el bien, porque la recompensa es segura en Cristo.", oracao: "Ora a Dios pidiendo discernimiento para sembrar en el Esp√≠ritu. P√≠dele que renueve tus fuerzas para no cansarte de hacer el bien, viviendo para Su gloria."}, fr: {h2: "Semer selon l'Esprit et R√©colter la Vie √âternelle", versiculos: "Galates 6:7-9 (Louis Segond): Ne vous y trompez pas: on ne se moque pas de Dieu. Ce qu'un homme aura sem√©, il le moissonnera aussi. Celui qui s√®me pour la chair moissonnera de la chair la corruption; mais celui qui s√®me pour l'Esprit moissonnera de l'Esprit la vie √©ternelle. Ne nous lassons pas de faire le bien; car nous moissonnerons en son temps, si nous ne nous rel√¢chons point.", resumo: "La conclusion de Galates nous rappelle la Souverainet√© de Dieu (Soli Deo Gloria) et le principe des semailles et de la moisson. La vie en Christ, justifi√©e par la foi, est soutenue par l'Esprit. Nos actions (chair vs. Esprit) ont des cons√©quences spirituelles. Ce n'est pas pour gagner le salut, mais pour manifester le salut d√©j√† re√ßu, vivant dans l'amour et le soin mutuel.", aplicacao: "Qu'avez-vous le plus 'sem√©' dans votre vie aujourd'hui: du temps dans les choses de la chair (soucis, peurs, vices) ou du temps dans les choses de l'Esprit (pri√®re, Parole, service)? Continuez √† faire le bien, car la r√©compense est certaine en Christ.", oracao: "Priez Dieu demandant le discernement pour semer dans l'Esprit. Demandez-Lui de renouveler vos forces pour ne pas vous lasser de faire le bien, vivant pour Sa gloire."}}
        };

        // --- FUN√á√ïES DE PROGRESSO (CORRIGIDAS) ---

        function getCompletionStatus(day) {
            // Verifica o status do dia espec√≠fico
            return localStorage.getItem(`devotionalCompleted_${DEVOTIONAL_KEY}_${day}`) === 'true';
        }

        function saveCompletion(day, isCompleted) {
            // Salva o status de conclus√£o
            localStorage.setItem(`devotionalCompleted_${DEVOTIONAL_KEY}_${day}`, isCompleted);
            updateOverallProgress(); // Atualiza a barra ap√≥s salvar
        }

        function updateProgressState() {
            // üí• CORRE√á√ÉO AQUI: Obt√©m o status do dia atual e atualiza o checkbox
            const isCompleted = getCompletionStatus(currentDay);
            completedCheck.checked = isCompleted;
            
            prevButton.disabled = currentDay === 1;
            nextButton.disabled = currentDay === totalDays;
        }

        function updateOverallProgress() {
            // Calcula o progresso total e atualiza a barra
            let completedCount = 0;
            for (let i = 1; i <= totalDays; i++) {
                // Usa a fun√ß√£o corrigida
                if (getCompletionStatus(i)) {
                    completedCount++;
                }
            }
            const progress = (completedCount / totalDays) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Atualiza a label
            const t = translations[currentLang] || translations['pt-BR']; 
            progressLabel.innerText = `${t.progressLabelPrefix}${completedCount} de ${totalDays} Conclu√≠dos`;
        }
        
        // --- INICIALIZA√á√ÉO (CORRIGIDA) ---
        window.onload = () => {
            // 0. üí• NOVO: Cancela qualquer √°udio em execu√ß√£o ao carregar a p√°gina (corre√ß√£o de persist√™ncia em alguns navegadores).
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }

            // 1. Tenta carregar o progresso salvo
            const savedDay = parseInt(localStorage.getItem(`devotionalProgress_${DEVOTIONAL_KEY}`)) || 1;
            currentDay = Math.min(savedDay, totalDays); 

            // 2. Aplica as prefer√™ncias salvas
            loadThemePreference();
            updateFontSize();

            // 3. Inicializa idioma e carrega o conte√∫do
            updateLanguageSelector();
            // üí• CORRE√á√ÉO: Chama updateTexts. Ele, por sua vez, carrega o conte√∫do E chama as fun√ß√µes de progresso na ordem correta.
            updateTexts(0); 

            // 4. Inicializa o TTS (Web Speech API)
            initTTS();

            // 5. Adiciona Listeners
            themeToggle.addEventListener('click', toggleDarkMode); 

            if (listenToggle) {
                listenToggle.addEventListener('click', handleListenClick); 
                // üõë Duplo Clique para STOP expl√≠cito
                listenToggle.addEventListener('dblclick', stopSpeaking);
            }
            
            // Listeners do Seletor de Idioma
            langSelectButton.addEventListener('click', (event) => {
                event.stopPropagation();
                const isExpanded = langDropdown.style.display === 'block';
                langDropdown.style.display = isExpanded ? 'none' : 'block';
                // NOVO ARIA: Atualiza o status de expans√£o
                langSelectButton.setAttribute('aria-expanded', !isExpanded); 
            });
            document.addEventListener('click', (event) => {
                const wrapper = document.querySelector('.language-selector-wrapper');
                if (langDropdown.style.display === 'block' && !wrapper.contains(event.target)) {
                    langDropdown.style.display = 'none';
                    // NOVO ARIA: Garante que o status volte a false ao fechar
                    langSelectButton.setAttribute('aria-expanded', 'false'); 
                }
            });

            prevButton.addEventListener('click', prevDay);
            nextButton.addEventListener('click', nextDay);
            completedCheck.addEventListener('change', handleCompletedCheck);
            
            // NOVO: Listeners para o controle de fonte
            document.getElementById('fontSizeIncrease').addEventListener('click', increaseFontSize);
            document.getElementById('fontSizeDecrease').addEventListener('click', decreaseFontSize);
        };
        
    </script>
</body>
</html>